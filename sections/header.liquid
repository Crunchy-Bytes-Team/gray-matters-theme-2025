<div
  class='announcement-bar-container fixed top-0 left-0 right-0 z-[60] transition-all duration-300 ease-out'
  data-announcement-bar
  style='transform: translateY(0); opacity: 1;'
>
  {% render 'message-bar', section: section %}
</div>
<style>
  .announcement-bar-container {
    will-change: transform, opacity;
  }

  .announcement-bar-container[style*='opacity: 0'] {
    pointer-events: none;
  }

  [data-site-header] {
    transition: top 0.3s ease-out;
  }
</style>
<header
  class='bg-white px-4 h-12 flex flex-row items-center fixed left-0 right-0 z-[70] transition-all duration-300 ease-out'
  data-site-header
  style='top: 0;'
>
  <div class='w-full flex flex-row justify-between bg-white h-full items-center'>
    <!-- hamburger -->
    <div class='flex lg:hidden w-2/12 items-start'>
      <button
        type='button'
        aria-label='Apri menu'
        class='p-2 text-black hover:opacity-70 transition-opacity duration-200 ease-out'
        data-open-mobile-menu
      >
        <i class='fa-solid fa-bars text-xl' aria-hidden='true'></i>
      </button>
    </div>
    <!-- logo -->
    <div class='flex flex-row justify-center w-10/12 lg:w-auto'>
      <a
        href='{{  routes.root_url }}'
        class='site-header__logo-image{% if section.settings.align_logo == 'center' %} site-header__logo-image--centered{% endif %}'
      >
        <img
          src='{{ 'logo-gray-matters.png' | asset_url }}'
          width='180'
          height='60'
          alt='{{ shop.name }} logo'
        >
      </a>
    </div>
    <!-- menu + icons -->
    <div class='flex flex-row items-end h-full w-2/12 lg:w-auto'>
      <!-- menu -->
      <nav class='hidden lg:flex flex-row items-center justify-center gap-1 text-black mr-10 h-full'>
        <div class='relative group h-full'>
          <a
            href='{{ routes.collections_url }}/all'
            class='h-full inline-flex items-center px-7 hover:opacity-70 hover:bg-gray-200 group-hover:bg-gray-200 transition-all duration-200 ease-out proxima-reg text-sm tracking-wider uppercase text-dark-gray'
            >Collection</a
          >
          <div class='absolute left-0 top-full opacity-0 pointer-events-none group-hover:opacity-100 group-hover:pointer-events-auto group-focus-within:opacity-100 group-focus-within:pointer-events-auto transition-opacity duration-200 ease-out z-50'>
            <ul class='min-w-[200px] text-black py-2' style='background-color: #e6e6e6;'>
              {% for link in linklists.collection.links %}
                <li>
                  <a
                    href='{{ link.url }}'
                    class='block px-4 py-2 proxima-reg text-sm tracking-wider uppercase hover:opacity-70 transition-opacity text-dark-gray {% if link.url contains 'sale' %}font-semibold{% endif %}'
                  >
                    {{- link.title | escape -}}
                  </a>
                </li>
              {% endfor %}
            </ul>
          </div>
        </div>

        <div class='relative group h-full'>
          <a
            href='/pages/select-language'
            class='h-full inline-flex items-center px-7 hover:opacity-70 hover:bg-gray-200 group-hover:bg-gray-200 transition-all duration-200 ease-out proxima-reg text-sm tracking-wider uppercase text-dark-gray'
            aria-haspopup='true'
            >Select language</a
          >
          <div class='absolute left-0 top-full opacity-0 pointer-events-none group-hover:opacity-100 group-hover:pointer-events-auto group-focus-within:opacity-100 group-focus-within:pointer-events-auto transition-opacity duration-200 ease-out z-50'>
            <ul class='min-w-[200px] text-black py-2 shadow-lg' style='background-color: #e6e6e6;'>
              {% for language in localization.available_languages %}
                <li>
                  {% if language.iso_code == localization.language.iso_code %}
                    <span
                      class='block px-4 py-2 proxima-reg text-sm tracking-wider uppercase cursor-default font-semibold text-dark-gray'
                    >
                      {{ language.endonym_name | default: language.name }}
                    </span>
                  {% else %}
                    <a
                      href='{{ language.root_url }}'
                      hreflang='{{ language.iso_code }}'
                      class='block px-4 py-2 proxima-reg text-sm tracking-wider hover:opacity-70 transition-opacity text-dark-gray'
                    >
                      {{ language.endonym_name | default: language.name | upcase }}
                    </a>
                  {% endif %}
                </li>
              {% endfor %}
            </ul>
          </div>
        </div>

        <div class='relative group h-full'>
          <a
            href='/pages/client-service'
            class='h-full inline-flex items-center px-7 hover:opacity-70 hover:bg-gray-200 group-hover:bg-gray-200 transition-all duration-200 ease-out proxima-reg text-sm tracking-wider uppercase text-dark-gray'
            aria-haspopup='true'
            >Client Service</a
          >
          <div class='absolute left-0 top-full opacity-0 pointer-events-none group-hover:opacity-100 group-hover:pointer-events-auto group-focus-within:opacity-100 group-focus-within:pointer-events-auto transition-opacity duration-200 ease-out z-50'>
            <div class='min-w-[200px] text-black py-2 shadow-lg' style='background-color: #e6e6e6;'>
              <a
                href='mailto:hello@graymattersnyc.com'
                class='flex items-center gap-2 px-4 py-2 proxima-reg text-xs tracking-wider hover:opacity-70 transition-opacity text-dark-gray'
              >
                <i class='fa-solid fa-envelope text-gray-400' aria-hidden='true'></i>
                <span>Email</span>
              </a>
              <a
                href='tel:+19292950303'
                class='flex items-center gap-2 px-4 py-2 proxima-reg text-xs tracking-wider hover:opacity-70 transition-opacity text-dark-gray'
              >
                <i class='fa-solid fa-phone text-gray-400' aria-hidden='true'></i>
                <span>+1 929 295 0303</span>
              </a>
              <span class='block px-4 py-1 proxima-reg text-xs tracking-wider text-gray-600'>
                Mon-Fri 10am-6pm EST
              </span>
              <div class='w-full px-4'>
                <div class='border-t border-gray-300 mt-4 mb-2'></div>
              </div>
              {% assign client_services_menu = linklists['top-client-services'] %}
              {% if client_services_menu != blank and client_services_menu.links != blank %}
                {% for link in client_services_menu.links %}
                  <a
                    href='{{ link.url }}'
                    class='block px-4 py-2 proxima-reg text-xs tracking-wider uppercase hover:opacity-70 transition-opacity text-dark-gray'
                  >
                    {{ link.title }}
                  </a>
                {% endfor %}
              {% endif %}
            </div>
          </div>
        </div>
      </nav>
      <!-- icons -->
      <div class='flex items-center justify-end gap-0 lg:gap-8 text-black h-full w-full lg:w-auto'>
        <!-- Instagram -->
        <a
          href='https://instagram.com/graymattersnyc'
          target='_blank'
          aria-label='Instagram'
          class='hover:opacity-70 transition-opacity duration-200 ease-out'
        >
          <img
            src='{{ 'icons/instagram-icon.png' | asset_url }}'
            alt='Instagram'
            width='20'
            height='20'
            class='w-5 h-5'
          >
        </a>
        <!-- User Account -->
        {% if shop.customer_accounts_enabled %}
          {% if customer %}
            <a
              href='{{ routes.account_url }}'
              aria-label='{{ 'customer.account_fallback' | t }}'
              class='hidden lg:flex hover:opacity-70 transition-opacity duration-200 ease-out'
            >
              <img
                src='{{ 'icons/user_new.png' | asset_url }}'
                alt='{{ 'customer.account_fallback' | t }}'
                width='20'
                height='20'
                class='w-5 h-5'
              >
            </a>
          {% else %}
            <a
              href='{{ routes.account_login_url }}'
              aria-label='{{ 'customer.log_in' | t }}'
              class='hidden lg:flex hover:opacity-70 transition-opacity duration-200 ease-out'
            >
              <img
                src='{{ 'icons/user_new.png' | asset_url }}'
                alt='{{ 'customer.log_in' | t }}'
                width='20'
                height='20'
                class='w-5 h-5'
              >
            </a>
          {% endif %}
        {% endif %}
        <!-- Search -->
        <button
          type='button'
          data-toggle-search
          aria-label='{{ 'general.search.search' | t }}'
          aria-expanded='false'
          aria-controls='HeaderSearchContainer'
          class='hidden lg:flex hover:opacity-70 transition-opacity duration-200 ease-out bg-transparent border-none p-0'
        >
          <i class='fa-solid fa-magnifying-glass' aria-hidden='true'></i>
        </button>
        <!-- Cart -->
        <button
          id='cart-icon-bubble'
          type='button'
          class='relative hover:opacity-70 transition-opacity duration-200 ease-out bg-transparent border-none p-0'
          aria-label='{{ 'templates.cart.cart' | t }}'
        >
          <img
            src='{{ 'icons/cart_icon_empty.png' | asset_url }}'
            alt='{{ 'templates.cart.cart' | t }}'
            width='20'
            height='20'
            class='w-5 h-5'
          >
          {%- if cart != empty -%}
            <div class='cart-count-bubble absolute -top-2 -right-2 bg-black text-white text-xs rounded-full w-5 h-5 flex items-center justify-center'>
              {%- if cart.item_count < 100 -%}
                <span aria-hidden='true'>{{ cart.item_count }}</span>
              {%- endif -%}
              <span class='visually-hidden'>{{ 'sections.header.cart_count' | t: count: cart.item_count }}</span>
            </div>
          {%- endif -%}
        </button>
      </div>
    </div>
  </div>
</header>
<!-- Mobile menu drawer -->
<div
  id='MobileMenu'
  class='fixed inset-0 z-[60] lg:hidden hidden opacity-0 pointer-events-none transition-opacity duration-300 ease-out'
  aria-hidden='true'
>
  <!-- overlay -->
  <button
    class='absolute inset-0 bg-black/50 opacity-0 transition-opacity duration-300 ease-out'
    data-close-mobile-menubg-white
    px-4
    h-12
    flex
    flex-row
    items-center
    fixed
    top-6
    left-0
    right-0
    z-[70]
    data-menu-overlay
    aria-label='Chiudi menu'
  ></button>
  <!-- drawer -->
  <aside
    class='absolute left-0 top-0 h-full w-[285px] max-w-[85%] bg-gray shadow-xl px-6 py-16 overflow-y-auto transition-transform duration-300 ease-out -translate-x-full'
    data-menu-drawer
  >
    <button class='absolute top-3 right-3 p-2' data-close-mobile-menu aria-label='Chiudi menu'>
      <i class='fa-solid fa-xmark text-xl' aria-hidden='true'></i>
    </button>
    {% render 'mobile-menu' %}
  </aside>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      var openBtn = document.querySelector('[data-open-mobile-menu]');
      var menu = document.getElementById('MobileMenu');
      var overlay = menu ? menu.querySelector('[data-menu-overlay]') : null;
      var drawer = menu ? menu.querySelector('[data-menu-drawer]') : null;
      var closers = menu ? menu.querySelectorAll('[data-close-mobile-menu]') : [];
      var TRANSITION_MS = 300;
      var siteHeader = document.querySelector('[data-site-header]');
      var announcementBar = document.querySelector('[data-announcement-bar]');
      var HEADER_SCROLL_THRESHOLD = 0;

      // Update spacer height dynamically based on header position
      function updateSpacerHeight() {
        const spacer = document.querySelector('.header-spacer');
        const header = document.querySelector('[data-site-header]');
        const announcementBar = document.querySelector('[data-announcement-bar]');

        if (spacer && header) {
          // Spacer should match header height (48px) plus any visible announcement bar height
          let spacerHeight = 48; // Header height (h-12 = 48px)

          if (announcementBar && announcementBar.style.display !== 'none') {
            // Check if announcement bar is actually visible (not hidden via transform)
            const isVisible =
              announcementBar.style.opacity !== '0' &&
              announcementBar.style.transform !== 'translateY(-100%)' &&
              !announcementBar.style.transform.includes('translateY(-100%)');

            if (isVisible) {
              const barHeight = announcementBar.offsetHeight;
              if (barHeight > 0) {
                spacerHeight += barHeight;
              }
            }
          }

          spacer.style.height = spacerHeight + 'px';
        }
      }

      // Initialize announcement bar scroll behavior
      function initAnnouncementBar() {
        if (!announcementBar || !siteHeader) return;

        // Check if announcement bar has content
        const announcementContent = announcementBar.querySelector('#announcement-bar-message');
        const hasContent = announcementContent && announcementContent.textContent.trim() !== '';

        if (!hasContent) {
          // No content, hide announcement bar completely
          announcementBar.style.display = 'none';

          // When no announcement bar, header should always be at top-0 (sticky mode height)
          // Remove any top-6 class and ensure top-0
          siteHeader.classList.remove('top-6');
          siteHeader.classList.add('top-0');
          siteHeader.style.top = '0';

          // Update search container position
          syncSearchContainerTop();

          // No scroll handler needed - header stays at top-0 always when no announcement bar
          return;
        }

        // Has content, implement scroll direction detection
        let lastScrollY = window.scrollY;
        let announcementBarHeight = announcementBar.offsetHeight;

        function hideAnnouncementBar() {
          announcementBar.style.transform = 'translateY(-100%)';
          announcementBar.style.opacity = '0';
          updateSpacerHeight();
          syncSearchContainerTop();
        }

        function showAnnouncementBar() {
          announcementBar.style.transform = 'translateY(0)';
          announcementBar.style.opacity = '1';
          // Delay to ensure height is calculated after show
          requestAnimationFrame(() => {
            updateSpacerHeight();
            syncSearchContainerTop();
          });
        }

        function moveHeaderToTop() {
          // Remove any top class and set to top-0
          siteHeader.classList.remove('top-6');
          if (!siteHeader.classList.contains('top-0')) {
            siteHeader.classList.add('top-0');
          }
          // Set to top-0 explicitly
          siteHeader.style.top = '0';
          // Update search container position
          syncSearchContainerTop();
        }

        function adjustHeaderForAnnouncementBar() {
          // When announcement bar is visible, position header below it
          // Get the actual rendered height of the announcement bar
          const barHeight = announcementBar.offsetHeight;

          if (barHeight > 0) {
            siteHeader.classList.remove('top-0');
            if (!siteHeader.classList.contains('top-6')) {
              siteHeader.classList.add('top-6');
            }
            // Position header below announcement bar using its actual height
            siteHeader.style.top = barHeight + 'px';
          } else {
            // Fallback: use default top-6 if height is 0
            siteHeader.classList.remove('top-0');
            if (!siteHeader.classList.contains('top-6')) {
              siteHeader.classList.add('top-6');
            }
            siteHeader.style.top = '';
          }

          // Update search container position when header position changes
          syncSearchContainerTop();
        }

        function handleScroll() {
          const currentScrollY = window.scrollY;
          const scrollingDown = currentScrollY > lastScrollY;
          const isAtTop = currentScrollY <= HEADER_SCROLL_THRESHOLD;
          const scrollDelta = Math.abs(currentScrollY - lastScrollY);

          // Update announcement bar height if it changed (e.g., on resize)
          const currentHeight = announcementBar.offsetHeight;
          if (currentHeight !== announcementBarHeight) {
            announcementBarHeight = currentHeight;
          }

          if (isAtTop) {
            // At top of page, always show announcement bar
            showAnnouncementBar();
            // Small delay to ensure height is calculated after show
            requestAnimationFrame(() => {
              adjustHeaderForAnnouncementBar();
            });
          } else if (scrollingDown && scrollDelta > 5) {
            // Scrolling down (with threshold to avoid jitter), hide announcement bar and move header to top
            hideAnnouncementBar();
            moveHeaderToTop();
          } else if (!scrollingDown && scrollDelta > 5) {
            // Scrolling up (with threshold), show announcement bar and adjust header
            showAnnouncementBar();
            // Small delay to ensure height is calculated after show
            requestAnimationFrame(() => {
              adjustHeaderForAnnouncementBar();
            });
          }

          lastScrollY = currentScrollY;
        }

        // Initial setup
        if (window.scrollY <= HEADER_SCROLL_THRESHOLD) {
          showAnnouncementBar();
          adjustHeaderForAnnouncementBar();
        } else {
          hideAnnouncementBar();
          moveHeaderToTop();
        }

        window.addEventListener('scroll', handleScroll, { passive: true });
      }

      // Note: syncHeaderOffset removed - no longer needed since header stays at top-0 when no announcement bar

      // Initialize announcement bar behavior
      initAnnouncementBar();

      // Update spacer on load and when announcement bar visibility changes
      updateSpacerHeight();
      setTimeout(updateSpacerHeight, 100);
      window.addEventListener('resize', updateSpacerHeight);

      // Add hover event listeners to manually control dropdown visibility
      const menuGroups = document.querySelectorAll('nav .group');
      menuGroups.forEach((group, index) => {
        // Try multiple selectors to find dropdown
        let dropdown = group.querySelector('div[class*="opacity-0"]');
        if (!dropdown) {
          dropdown = group.querySelector('div[class*="-translate-y"]');
        }
        if (!dropdown) {
          // Look for any absolute positioned div (dropdown container)
          dropdown = group.querySelector('div.absolute');
        }
        if (!dropdown) {
          // Look for any div that's a direct child
          const divs = Array.from(group.children).filter((c) => c.tagName === 'DIV');
          dropdown = divs.length > 0 ? divs[0] : null;
        }

        if (!dropdown) {
          return;
        }

        // Initialize dropdown state - using opacity-only animation to avoid hover breakage
        dropdown.style.opacity = '0';
        dropdown.style.pointerEvents = 'none';
        dropdown.style.transition = 'opacity 200ms ease-out';

        let hideTimeout = null;

        // Manually control dropdown visibility
        group.addEventListener('mouseenter', function () {
          // Clear any pending hide
          if (hideTimeout) {
            clearTimeout(hideTimeout);
            hideTimeout = null;
          }

          // Show dropdown
          dropdown.style.opacity = '1';
          dropdown.style.pointerEvents = 'auto';
        });

        group.addEventListener('mouseleave', function (e) {
          const relatedTarget = e.relatedTarget;
          const groupRect = group.getBoundingClientRect();
          const dropdownRect = dropdown.getBoundingClientRect();
          const mouseY = e.clientY;
          const mouseX = e.clientX;

          // Check if mouse is moving toward dropdown - check both relatedTarget and actual mouse position
          const isMovingToDropdown = relatedTarget && (dropdown.contains(relatedTarget) || dropdown === relatedTarget);
          const isInDropdownArea =
            mouseX >= dropdownRect.left &&
            mouseX <= dropdownRect.right &&
            mouseY >= dropdownRect.top &&
            mouseY <= dropdownRect.bottom;

          // Also check what element is actually under the mouse cursor
          const elementUnderMouse = document.elementFromPoint(mouseX, mouseY);
          const mouseIsInDropdown =
            elementUnderMouse && (dropdown.contains(elementUnderMouse) || dropdown === elementUnderMouse);

          // Clear any pending hide timeout
          if (hideTimeout) {
            clearTimeout(hideTimeout);
            hideTimeout = null;
          }

          // When entering from below, mouse can be in dropdown area but elementFromPoint returns child elements
          // Use isInDropdownArea as the PRIMARY check - it's more reliable than elementFromPoint
          // Also check if mouse is moving down toward dropdown area (entering from below)
          const isMovingDown = mouseY > groupRect.bottom;
          const shouldKeepVisible = isInDropdownArea || isMovingDown || mouseIsInDropdown || isMovingToDropdown;

          if (!shouldKeepVisible) {
            hideTimeout = setTimeout(function () {
              // Final check: get fresh bounding rect and verify mouse is still not in dropdown area
              const freshDropdownRect = dropdown.getBoundingClientRect();
              const freshMouseElement = document.elementFromPoint(mouseX, mouseY);
              const freshIsInDropdownArea =
                mouseX >= freshDropdownRect.left &&
                mouseX <= freshDropdownRect.right &&
                mouseY >= freshDropdownRect.top &&
                mouseY <= freshDropdownRect.bottom;
              const freshMouseIsInDropdown =
                freshMouseElement && (dropdown.contains(freshMouseElement) || dropdown === freshMouseElement);

              if (!freshIsInDropdownArea && !freshMouseIsInDropdown) {
                dropdown.style.opacity = '0';
                dropdown.style.pointerEvents = 'none';
              }
              hideTimeout = null;
            }, 200); // Increased delay to allow mouse to reach dropdown when entering from below
          } else {
            // Mouse is in dropdown area or moving toward it - ensure dropdown stays visible
            if (hideTimeout) {
              clearTimeout(hideTimeout);
              hideTimeout = null;
            }
            dropdown.style.opacity = '1';
            dropdown.style.pointerEvents = 'auto';
          }
        });

        // Also handle dropdown hover to keep it visible
        // This is critical when entering from below - mouse can enter dropdown before group
        dropdown.addEventListener('mouseenter', function () {
          // Clear any pending hide
          if (hideTimeout) {
            clearTimeout(hideTimeout);
            hideTimeout = null;
          }

          // Always show dropdown when mouse enters it (even if entering from below)
          dropdown.style.opacity = '1';
          dropdown.style.pointerEvents = 'auto';
        });

        // Also listen for mousemove over dropdown area to catch cases where mouseenter might not fire
        // This helps when entering from below where dropdown might have pointer-events-none initially
        dropdown.addEventListener('mousemove', function (e) {
          const computed = window.getComputedStyle(dropdown);
          if (computed.opacity === '0' || computed.pointerEvents === 'none') {
            // Mouse is in dropdown area but dropdown is hidden - show it
            if (hideTimeout) {
              clearTimeout(hideTimeout);
              hideTimeout = null;
            }
            dropdown.style.opacity = '1';
            dropdown.style.pointerEvents = 'auto';
          }
        });

        dropdown.addEventListener('mouseleave', function (e) {
          const relatedTarget = e.relatedTarget;
          const mouseY = e.clientY;
          const mouseX = e.clientX;
          const dropdownRect = dropdown.getBoundingClientRect();

          // Check if mouse is moving back to group or still in dropdown area
          const isMovingToGroup = relatedTarget && (group.contains(relatedTarget) || group === relatedTarget);
          const isStillInDropdownArea =
            mouseX >= dropdownRect.left &&
            mouseX <= dropdownRect.right &&
            mouseY >= dropdownRect.top &&
            mouseY <= dropdownRect.bottom;

          // Only hide if mouse is truly leaving (not moving to group and not still in dropdown area)
          if (!isMovingToGroup && !isStillInDropdownArea) {
            // Use a small delay to catch cases where mouse is moving between dropdown and group
            setTimeout(function () {
              const finalCheckRect = dropdown.getBoundingClientRect();
              const finalCheckElement = document.elementFromPoint(mouseX, mouseY);
              const finalIsInDropdownArea =
                mouseX >= finalCheckRect.left &&
                mouseX <= finalCheckRect.right &&
                mouseY >= finalCheckRect.top &&
                mouseY <= finalCheckRect.bottom;
              const finalIsInGroup =
                finalCheckElement && (group.contains(finalCheckElement) || group === finalCheckElement);

              if (!finalIsInDropdownArea && !finalIsInGroup) {
                dropdown.style.opacity = '0';
                dropdown.style.pointerEvents = 'none';
              }
            }, 100);
          }
        });
      });

      function openMenu() {
        if (!menu) return;
        // show container to allow transitions
        menu.classList.remove('hidden');
        // next frame to ensure transition applies
        requestAnimationFrame(function () {
          document.body.classList.add('overflow-hidden');
          menu.setAttribute('aria-hidden', 'false');
          menu.classList.remove('opacity-0', 'pointer-events-none');
          menu.classList.add('opacity-100');
          if (overlay) overlay.classList.remove('opacity-0');
          if (overlay) overlay.classList.add('opacity-100');
          if (drawer) drawer.classList.remove('-translate-x-full');
          if (drawer) drawer.classList.add('translate-x-0');
        });
      }
      function closeMenu() {
        if (!menu) return;
        // start transitions
        menu.classList.add('opacity-0');
        menu.classList.remove('opacity-100');
        if (overlay) overlay.classList.add('opacity-0');
        if (overlay) overlay.classList.remove('opacity-100');
        if (drawer) drawer.classList.add('-translate-x-full');
        if (drawer) drawer.classList.remove('translate-x-0');
        menu.setAttribute('aria-hidden', 'true');
        document.body.classList.remove('overflow-hidden');
        // after transition, hide and disable pointer events
        setTimeout(function () {
          menu.classList.add('hidden', 'pointer-events-none');
        }, TRANSITION_MS);
      }

      if (openBtn) openBtn.addEventListener('click', openMenu);
      if (closers && closers.forEach) {
        closers.forEach(function (el) {
          el.addEventListener('click', closeMenu);
        });
      }
      window.addEventListener('keydown', function (e) {
        if (e.key === 'Escape') {
          closeMenu();
          hideSearch();
        }
      });

      var searchToggle = document.querySelector('[data-toggle-search]');
      var searchContainer = document.getElementById('HeaderSearchContainer');
      var searchHideTimer = null;
      var SEARCH_TRANSITION_MS = 250;
      var HEADER_HEIGHT = 48; // h-12 = 48px

      function syncSearchContainerTop() {
        if (!searchContainer) return;

        // Calculate search container top position based on header and announcement bar
        let searchTop = HEADER_HEIGHT;

        // Check if announcement bar is visible
        if (announcementBar && announcementBar.style.display !== 'none') {
          const isVisible =
            announcementBar.style.opacity !== '0' &&
            announcementBar.style.transform !== 'translateY(-100%)' &&
            !announcementBar.style.transform.includes('translateY(-100%)');

          if (isVisible) {
            const barHeight = announcementBar.offsetHeight;
            if (barHeight > 0) {
              searchTop += barHeight;
            }
          }
        }

        var nextTopValue = searchTop + 'px';
        if (searchContainer.style.top !== nextTopValue) {
          searchContainer.style.top = nextTopValue;
        }
      }

      syncSearchContainerTop();
      window.addEventListener('scroll', syncSearchContainerTop);

      function showSearch() {
        if (!searchContainer) return;
        if (searchHideTimer) {
          clearTimeout(searchHideTimer);
          searchHideTimer = null;
        }
        searchContainer.classList.remove('hidden');
        requestAnimationFrame(function () {
          searchContainer.classList.add('is-search-active');
        });
        if (searchToggle) {
          searchToggle.setAttribute('aria-expanded', 'true');
        }
        var searchInput = searchContainer.querySelector('input[name="q"]');
        if (searchInput) {
          setTimeout(function () {
            searchInput.focus();
          }, 0);
        }
      }

      function hideSearch() {
        if (!searchContainer) return;
        if (searchContainer.classList.contains('hidden')) return;
        if (searchHideTimer) {
          clearTimeout(searchHideTimer);
          searchHideTimer = null;
        }
        searchContainer.classList.remove('is-search-active');
        if (searchToggle) {
          searchToggle.setAttribute('aria-expanded', 'false');
        }
        searchHideTimer = setTimeout(function () {
          searchContainer.classList.add('hidden');
        }, SEARCH_TRANSITION_MS);
      }

      if (searchToggle && searchContainer) {
        searchToggle.addEventListener('click', function (event) {
          event.preventDefault();
          var isHidden = searchContainer.classList.contains('hidden');
          if (isHidden) {
            showSearch();
          } else {
            hideSearch();
          }
        });

        document.addEventListener('click', function (event) {
          if (!searchContainer.contains(event.target) && (!searchToggle || !searchToggle.contains(event.target))) {
            hideSearch();
          }
        });
      }

      var searchCloseButtons = searchContainer ? searchContainer.querySelectorAll('[data-close-search]') : [];
      if (searchCloseButtons && searchCloseButtons.forEach) {
        searchCloseButtons.forEach(function (btn) {
          btn.addEventListener('click', function (event) {
            event.preventDefault();
            hideSearch();
          });
        });
      }
    });
  </script>
</div>
<div class='header-spacer' style='height: 48px;'></div>
<div
  id='HeaderSearchContainer'
  class='hidden container-search-form py-4 fixed inset-x-0 z-40 bg-gray-200 shadow-lg px-4 relative'
  style='top: 48px;'
>
  <button
    type='button'
    class='absolute top-4 right-4 p-2 text-gray-500 hover:text-gray-700 transition-colors duration-200 ease-out mr-4'
    data-close-search
    aria-label='Chiudi ricerca'
  >
    <i class='fa-solid fa-xmark text-xl' aria-hidden='true'></i>
  </button>
  <form
    action='{{ routes.search_url }}'
    method='get'
    class='search_form_top For_mobile_searxch'
    role='search'
  >
    <input type='hidden' name='type' value='product'>
    <i class='fa fa-search ic-down text-gray-300 ml-4'></i>
    <input
      class='search-header__input1 search__input1 form-control bg-transparent pl-6'
      type='search'
      name='q'
      id='search_input1'
      placeholder=''
      aria-label='{{ 'general.search.placeholder' | t }}'
    >
  </form>

  <div class='suggested-terms border-t border-gray-300 mt-5 pt-5 flex flex-row'>
    <h3 class='proxima-semi-bold uppercase tracking-widest pr-0 lg:pr-4'>Popular Searches</h3>
    <p>
      <span><a class='text-xs tracking-widest' href='{{ routes.search_url }}?q=bianco'>Bianco,</a></span>
      <span><a class='text-xs tracking-widest' href='{{ routes.search_url }}?q=cammello'>Cammello,</a></span>
      <span><a class='text-xs tracking-widest' href='{{ routes.search_url }}?q=classic'>Classic,</a></span>
      <span><a class='text-xs tracking-widest' href='{{ routes.search_url }}?q=color+block'>Color Block,</a></span>

      <span><a class='text-xs tracking-widest' href='{{ routes.search_url }}?q=gemma'>Gemma,</a></span>
      <span><a class='text-xs tracking-widest' href='{{ routes.search_url }}?q=emma'>Emma,</a></span>
      <span><a class='text-xs tracking-widest' href='{{ routes.search_url }}?q=clara'>Clara,</a></span>

      <span><a class='text-xs tracking-widest' href='{{ routes.search_url }}?q=egg'>Egg,</a></span>
      <span><a class='text-xs tracking-widest' href='{{ routes.search_url }}?q=junior'>Junior,</a></span>
      <span><a class='text-xs tracking-widest' href='{{ routes.search_url }}?q=micol'>Micol,</a></span>
      <span><a class='text-xs tracking-widest' href='{{ routes.search_url }}?q=mildred'>Mildred,</a></span>
      <span><a class='text-xs tracking-widest' href='{{ routes.search_url }}?q=nero'>Nero</a></span>
    </p>
  </div>
</div>
{% schema %}
{
  "name": {
    "de": "Titel",
    "en": "Header",
    "es": "Encabezado",
    "fr": "En-tête",
    "it": "Header",
    "ja": "ヘッダー",
    "nl": "Koptekst",
    "pt-BR": "Cabeçalho",
    "zh-CN": "标头",
    "zh-TW": "標頭"
  },
  "settings": [
    {
      "type": "radio",
      "id": "align_logo",
      "label": {
        "de": "Logo-Ausrichtung",
        "en": "Logo alignment",
        "es": "Alineación de logotipo",
        "fr": "Alignement du logo",
        "it": "Allineamento logo",
        "ja": "ロゴアラインメント",
        "nl": "Logo-uitlijning",
        "pt-BR": "Alinhamento do logotipo",
        "zh-CN": "logo 对齐方式",
        "zh-TW": "商標對齊"
      },
      "default": "left",
      "options": [
        {
          "value": "left",
          "label": {
            "de": "Links",
            "en": "Left",
            "es": "Izquierda",
            "fr": "Gauche",
            "it": "Sinistra",
            "ja": "左",
            "nl": "Links",
            "pt-BR": "Esquerda",
            "zh-CN": "左侧",
            "zh-TW": "左方"
          }
        },
        {
          "value": "center",
          "label": {
            "de": "Mittig",
            "en": "Centered",
            "es": "Centrada",
            "fr": "Centré",
            "it": "Centrato",
            "ja": "中央揃え",
            "nl": "Gecentreerd",
            "pt-BR": "Centralizado",
            "zh-CN": "居中",
            "zh-TW": "置中"
          }
        }
      ]
    },
    {
      "type": "image_picker",
      "id": "logo",
      "label": {
        "de": "Logo-Foto",
        "en": "Logo image",
        "es": "Logotipo",
        "fr": "Image du logo",
        "it": "Immagine del logo",
        "ja": "ロゴ画像",
        "nl": "Afbeelding van logo",
        "pt-BR": "Imagem do logotipo",
        "zh-CN": "logo 图片",
        "zh-TW": "標誌圖片"
      }
    },
    {
      "type": "range",
      "id": "logo_max_width",
      "label": {
        "de": "Logobreite",
        "en": "Custom logo width",
        "es": "Ancho del logotipo personalizado",
        "fr": "Largeur personnalisée du logo",
        "it": "Larghezza logo personalizzato",
        "ja": "ロゴの幅をカスタムする",
        "nl": "Aangepaste logo-breedte",
        "pt-BR": "Largura do logotipo personalizado",
        "zh-CN": "自定义 logo 宽度",
        "zh-TW": "自訂商標寬度"
      },
      "min": 50,
      "max": 250,
      "step": 5,
      "unit": {
        "de": "px",
        "en": "px",
        "es": "px",
        "fr": "px",
        "it": "px",
        "ja": "px",
        "nl": "px",
        "pt-BR": "px",
        "zh-CN": "px",
        "zh-TW": "像素"
      },
      "default": 100
    },
    {
      "type": "link_list",
      "id": "main_linklist",
      "label": {
        "de": "Menü",
        "en": "Menu",
        "es": "Menú",
        "fr": "Menu",
        "it": "Menu",
        "ja": "メニュー",
        "nl": "Menu",
        "pt-BR": "Menu",
        "zh-CN": "菜单",
        "zh-TW": "選單"
      },
      "default": "main-menu"
    },
    {
      "type": "header",
      "content": {
        "de": "Ankündigungsbereich",
        "en": "Announcement bar",
        "es": "Barra de anuncios",
        "fr": "Barre d'annonces",
        "it": "Barra degli annunci",
        "ja": "告知バー",
        "nl": "Aankondigingsbalk",
        "pt-BR": "Barra de anúncios",
        "zh-CN": "公告栏",
        "zh-TW": "公告列"
      }
    },
    {
      "type": "checkbox",
      "id": "message",
      "label": {
        "de": "Ankündigung anzeigen",
        "en": "Show announcement",
        "es": "Mostrar anuncio",
        "fr": "Afficher l'annonce",
        "it": "Mostra annuncio",
        "ja": "告知を表示する",
        "nl": "Aankondiging weergeven",
        "pt-BR": "Exibir anúncio",
        "zh-CN": "显示公告",
        "zh-TW": "顯示公告"
      },
      "default": false
    },
    {
      "type": "checkbox",
      "id": "home_page_only",
      "label": {
        "de": "Nur Startseite",
        "en": "Home page only",
        "es": "Solo página de inicio",
        "fr": "Page d'accueil uniquement",
        "it": "Solo home page",
        "ja": "ホームページのみ",
        "nl": "Alleen startpagina",
        "pt-BR": "Apenas página inicial",
        "zh-CN": "仅主页",
        "zh-TW": "僅限首頁"
      },
      "default": true
    },
    {
      "type": "checkbox",
      "id": "slide_animation",
      "label": {
        "de": "Animation aktivieren",
        "en": "Enable Slide Animation",
        "es": "Habilitar animación",
        "fr": "Activer l'animation",
        "it": "Abilita animazione",
        "ja": "アニメーションを有効にする",
        "nl": "Animatie inschakelen",
        "pt-BR": "Habilitar Animação",
        "zh-CN": "启用动画",
        "zh-TW": "啟用動畫"
      },
      "default": true
    },
    {
      "type": "checkbox",
      "id": "fade_animation",
      "label": {
        "de": "Aktivieren Sie die Fade-Animation",
        "en": "Enable Fade Animation",
        "es": "Habilitar animación de fundido",
        "fr": "Activer l'animation en fondu",
        "it": "Abilita animazione dissolvenza",
        "ja": "フェードアニメーションを有効にする",
        "nl": "Schakel Fade-animatie in",
        "pt-BR": "Habilitar Fade Animation",
        "zh-CN": "启用淡入淡出动画",
        "zh-TW": "启用淡入淡出动画"
      },
      "default": true
    },
    {
      "type": "text",
      "id": "message_text",
      "label": {
        "de": "Text",
        "en": "Text",
        "es": "Texto",
        "fr": "Texte",
        "it": "Testo",
        "ja": "テキスト",
        "nl": "Tekst",
        "pt-BR": "Texto",
        "zh-CN": "文本",
        "zh-TW": "文字"
      },
      "default": {
        "de": "Hier etwas ankündigen",
        "en": "Announce something here",
        "es": "Anuncia algo aquí",
        "fr": "Annoncez quelque chose ici",
        "it": "Annuncia qualcosa qui",
        "ja": "ここで告知してください",
        "nl": "Kondig hier iets aan",
        "pt-BR": "Anuncie algo aqui",
        "zh-CN": "在此处进行公告",
        "zh-TW": "在此公告資訊"
      }
    },
    {
      "type": "url",
      "id": "message_link",
      "label": {
        "de": "Link",
        "en": "Link",
        "es": "Enlace",
        "fr": "Lien",
        "it": "Link",
        "ja": "リンク",
        "nl": "Link",
        "pt-BR": "Link",
        "zh-CN": "链接",
        "zh-TW": "連結"
      },
      "info": {
        "de": "Optional",
        "en": "Optional",
        "es": "Opcional",
        "fr": "Facultatif",
        "it": "Facoltativo",
        "ja": "選択させる",
        "nl": "Optioneel",
        "pt-BR": "Opcional",
        "zh-CN": "可选",
        "zh-TW": "(選填)"
      }
    },
    {
      "type": "text",
      "id": "message_text_alt",
      "label": {
        "de": "Alternate Text",
        "en": "Alternate Text",
        "es": "Texto alternativo",
        "fr": "Texte alternatif",
        "it": "Testo alternato",
        "ja": "代替テキスト",
        "nl": "Alternatieve tekst",
        "pt-BR": "Texto alternativo",
        "zh-CN": "替代文字",
        "zh-TW": "替代文字"
      },
      "default": {
        "de": "Hier etwas ankündigen",
        "en": "Announce something here",
        "es": "Anuncia algo aquí",
        "fr": "Annoncez quelque chose ici",
        "it": "Annuncia qualcosa qui",
        "ja": "ここで告知してください",
        "nl": "Kondig hier iets aan",
        "pt-BR": "Anuncie algo aqui",
        "zh-CN": "在此处进行公告",
        "zh-TW": "在此公告資訊"
      }
    },
    {
      "type": "url",
      "id": "message_link_alt",
      "label": {
        "de": "Alternativer Link",
        "en": "Alternate Link",
        "es": "Enlace alternativo",
        "fr": "Lien Alternatif",
        "it": "Collegamento Alternativo",
        "ja": "代替リンク",
        "nl": "Alternatieve Link",
        "pt-BR": "Link Alternativo",
        "zh-CN": "替代链接",
        "zh-TW": "替代鏈接"
      }
    },
    {
      "type": "color",
      "id": "color_bg",
      "label": {
        "de": "Zeile",
        "en": "Bar",
        "es": "Barra",
        "fr": "Barre",
        "it": "Barra",
        "ja": "バー",
        "nl": "Balk",
        "pt-BR": "Barra",
        "zh-CN": "栏",
        "zh-TW": "橫條"
      },
      "default": "#7796a8"
    },
    {
      "type": "color",
      "id": "color_text",
      "label": {
        "de": "Text",
        "en": "Text",
        "es": "Texto",
        "fr": "Texte",
        "it": "Testo",
        "ja": "テキスト",
        "nl": "Tekst",
        "pt-BR": "Texto",
        "zh-CN": "文本",
        "zh-TW": "文字"
      },
      "default": "#fff"
    }
  ]
}
{% endschema %}
