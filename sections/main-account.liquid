<script src='{{ 'customer.js' | asset_url }}' defer></script>
<div class='max-w-7xl mx-auto px-6 md:px-20 py-20 md:py-40'>
  <div class='grid grid-cols-1 md:grid-cols-[1fr_3fr] gap-8 md:gap-12 relative'>
    <!-- Vertical Separator -->
    <div class='hidden md:block absolute left-[calc(25%-12px)] top-0 bottom-0 w-px bg-gray-200'></div>

    <!-- Left Column: Account Details, Addresses, Wishlist -->
    <div class='order-1 md:order-1'>
      <!-- ORDER HISTORY -->
      <div class='mb-4 flex items-center gap-2'>
        <i class='fa-solid fa-chevron-right text-sm'></i>
        <a
          href='{{ routes.account_url }}'
          class='text-lg md:text-xl font-bold uppercase tracking-wider hover:opacity-70 hover:underline transition-opacity'
        >
          {{ 'customer.orders.title' | t }}
        </a>
      </div>

      <!-- ACCOUNT DETAILS -->
      <div class='mb-4'>
        <div class='flex items-center gap-2 mb-4'>
          <i class='fa-solid fa-chevron-right text-sm'></i>
          <a
            href='#'
            onclick='toggleAccountDetails(event); return false;'
            data-turbo='false'
            class='text-lg md:text-xl font-bold uppercase tracking-wider hover:opacity-70 hover:underline transition-opacity'
          >
            {{ 'customer.account.details' | t }}
          </a>
        </div>
        <div class='space-y-2 text-sm hidden md:block'>
          <p class='font-semibold'>{{ customer.name }}</p>
          <p>{{ customer.email }}</p>
          <a href='#' onclick='toggleAccountEditForm(event)' class='underline hover:opacity-70 transition-opacity'>
            Edit
          </a>
        </div>
      </div>

      <!-- MY ADDRESSES -->
      <div class='mb-4'>
        <div class='flex items-center gap-2 mb-4'>
          <i class='fa-solid fa-chevron-right text-sm'></i>
          <a
            href='#'
            onclick='toggleAddressesList(event)'
            class='text-lg md:text-xl font-bold uppercase tracking-wider hover:opacity-70 hover:underline transition-opacity'
          >
            {{ 'customer.account.addresses' | t }}
          </a>
        </div>
        <div class='hidden md:block'>
          {%- if customer.default_address -%}
            <div class='mb-4 text-sm space-y-1'>
              {{ customer.default_address | format_address }}
            </div>
            <div class='space-x-4'>
              <a
                href='#'
                onclick='editAddressById({{ customer.default_address.id }}, event)'
                class='underline text-sm hover:opacity-70 transition-opacity'
              >
                Edit
              </a>
              <a
                href='#'
                onclick='toggleAddAddressForm(event); return false;'
                data-turbo='false'
                class='underline text-sm hover:opacity-70 transition-opacity'
              >
                Add New Address
              </a>
            </div>
          {%- else -%}
            <div class='mb-4 text-sm'>
              <p class='mb-2'>No address on file</p>
              <a
                href='#'
                onclick='toggleAddAddressForm(event); return false;'
                data-turbo='false'
                class='underline text-sm hover:opacity-70 transition-opacity'
              >
                Add New Address
              </a>
            </div>
          {%- endif -%}
        </div>
      </div>

      <!-- MY WISHLIST -->
      <div class='mb-4'>
        <div class='flex items-center gap-2 mb-4'>
          <i class='fa-solid fa-chevron-right text-sm'></i>
          <h2 class='text-lg md:text-xl font-bold uppercase tracking-wider'>
            {{ 'customer.account.wishlist' | t }}
          </h2>
        </div>
        <a
          href='{{ routes.root_url }}/pages/wishlist'
          class='underline text-sm hover:opacity-70 transition-opacity hidden md:block'
        >
          View/Edit Wishlist
        </a>
      </div>

      <!-- Logout -->
      <div class='mb-8 hidden md:block'>
        <a href='{{ routes.account_logout_url }}' class='underline text-sm hover:opacity-70 transition-opacity'>
          {{ 'customer.log_out' | t }}
        </a>
      </div>
    </div>

    <!-- Right Column: Order History / Account Edit Form -->
    <div class='order-2 md:order-2'>
      <div>
        <!-- Add Address Form (hidden by default) -->
        <div id='AddAddressForm' class='hidden mb-8' data-customer-addresses>
          {%- form 'customer_address', customer.new_address -%}
            <input type='hidden' name='return_to' value='{{ routes.account_url }}?show=addresses'>
            {%- if form.errors -%}
              <div class='mb-6 p-4 bg-red-50 border border-red-200 text-red-700 text-sm'>
                <h3 class='font-semibold mb-2'>{{ 'templates.contact.form.error_heading' | t }}</h3>
                <ul class='list-disc list-inside'>
                  {%- for field in form.errors -%}
                    <li>
                      {%- if field == 'form' -%}
                        {{ form.errors.messages[field] }}
                      {%- else -%}
                        {{ form.errors.translated_fields[field] | capitalize }}
                        {{ form.errors.messages[field] }}
                      {%- endif -%}
                    </li>
                  {%- endfor -%}
                </ul>
              </div>
            {%- endif -%}

            {%- if form.posted_successfully? -%}
              <div class='mb-6 p-4 bg-green-50 border border-green-200 text-green-700 text-sm'>
                {{ 'customer.addresses.add' | t | default: 'Address added successfully.' }}
              </div>
            {%- endif -%}

            <h1 class='text-lg md:text-xl font-bold uppercase tracking-wider mb-6'>ADD ADDRESS</h1>

            <div class='grid grid-cols-1 md:grid-cols-2 gap-4 mb-4'>
              <!-- First Name -->
              <div>
                <label for='AddressFirstNameNew' class='block text-sm font-medium mb-2'>
                  {{ 'customer.addresses.first_name' | t }}
                </label>
                <input
                  type='text'
                  id='AddressFirstNameNew'
                  name='address[first_name]'
                  value='{{ form.first_name }}'
                  autocomplete='given-name'
                  placeholder='{{ 'customer.addresses.first_name' | t }}'
                  class='w-full px-4 py-4 bg-gray-50 focus:outline-none'
                >
              </div>

              <!-- Last Name -->
              <div>
                <label for='AddressLastNameNew' class='block text-sm font-medium mb-2'>
                  {{ 'customer.addresses.last_name' | t }}
                </label>
                <input
                  type='text'
                  id='AddressLastNameNew'
                  name='address[last_name]'
                  value='{{ form.last_name }}'
                  autocomplete='family-name'
                  placeholder='{{ 'customer.addresses.last_name' | t }}'
                  class='w-full px-4 py-4 bg-gray-50 focus:outline-none'
                >
              </div>
            </div>

            <!-- Company -->
            <div class='mb-4'>
              <label for='AddressCompanyNew' class='block text-sm font-medium mb-2'>
                {{ 'customer.addresses.company' | t }}
              </label>
              <input
                type='text'
                id='AddressCompanyNew'
                name='address[company]'
                value='{{ form.company }}'
                autocomplete='organization'
                placeholder='{{ 'customer.addresses.company' | t }}'
                class='w-full px-4 py-4 bg-gray-50 focus:outline-none'
              >
            </div>

            <!-- Address Line 1 -->
            <div class='mb-4'>
              <label for='AddressAddress1New' class='block text-sm font-medium mb-2'>
                {{ 'customer.addresses.address1' | t }}
              </label>
              <input
                type='text'
                id='AddressAddress1New'
                name='address[address1]'
                value='{{ form.address1 }}'
                autocomplete='address-line1'
                placeholder='{{ 'customer.addresses.address1' | t }}'
                class='w-full px-4 py-4 bg-gray-50 focus:outline-none'
              >
            </div>

            <!-- Address Line 2 -->
            <div class='mb-4'>
              <label for='AddressAddress2New' class='block text-sm font-medium mb-2'>
                {{ 'customer.addresses.address2' | t }}
              </label>
              <input
                type='text'
                id='AddressAddress2New'
                name='address[address2]'
                value='{{ form.address2 }}'
                autocomplete='address-line2'
                placeholder='Apartment, Suite, etc'
                class='w-full px-4 py-4 bg-gray-50 focus:outline-none'
              >
            </div>

            <div class='grid grid-cols-1 md:grid-cols-2 gap-4 mb-4'>
              <!-- City -->
              <div>
                <label for='AddressCityNew' class='block text-sm font-medium mb-2'>
                  {{ 'customer.addresses.city' | t }}
                </label>
                <input
                  type='text'
                  id='AddressCityNew'
                  name='address[city]'
                  value='{{ form.city }}'
                  autocomplete='address-level2'
                  placeholder='{{ 'customer.addresses.city' | t }}'
                  class='w-full px-4 py-4 bg-gray-50 focus:outline-none'
                >
              </div>

              <!-- Country -->
              <div>
                <label for='AddressCountryNew' class='block text-sm font-medium mb-2'>
                  {{ 'customer.addresses.country' | t }}
                </label>
                <select
                  id='AddressCountryNew'
                  name='address[country]'
                  data-default='{{ form.country }}'
                  autocomplete='country'
                  data-address-country-select
                  data-form-id='new'
                  class='w-full px-4 py-4 bg-gray-50 focus:outline-none'
                >
                  {{ all_country_option_tags }}
                </select>
              </div>
            </div>

            <!-- Province -->
            <div id='AddressProvinceContainerNew' class='mb-4' style='display: none'>
              <label for='AddressProvinceNew' class='block text-sm font-medium mb-2'>
                {{ 'customer.addresses.province' | t }}
              </label>
              <select
                id='AddressProvinceNew'
                name='address[province]'
                data-default='{{ form.province }}'
                autocomplete='address-level1'
                class='w-full px-4 py-4 bg-gray-50 focus:outline-none'
              ></select>
            </div>

            <!-- Zip/Postal Code -->
            <div class='mb-4'>
              <label for='AddressZipNew' class='block text-sm font-medium mb-2'>
                {{ 'customer.addresses.zip' | t }}
              </label>
              <input
                type='text'
                id='AddressZipNew'
                name='address[zip]'
                value='{{ form.zip }}'
                autocapitalize='characters'
                autocomplete='postal-code'
                placeholder='Zip Code'
                class='w-full px-4 py-4 bg-gray-50 focus:outline-none'
              >
            </div>

            <!-- Set as default address -->
            <div class='mb-4'>
              <label class='flex items-center'>
                <input
                  type='checkbox'
                  id='address_default_address_new'
                  name='address[default]'
                  value='1'
                  class='mr-2'
                >
                <span class='text-sm'>{{ 'customer.addresses.set_default' | t }}</span>
              </label>
            </div>

            <!-- Buttons -->
            <div class='flex gap-4 mt-6'>
              <button
                type='submit'
                class='bg-black text-white py-3 px-8 uppercase tracking-wider text-sm font-semibold hover:opacity-90 transition-opacity'
              >
                SAVE ADDRESS
              </button>
              <button
                type='button'
                onclick='toggleAddAddressForm(event)'
                class='bg-white text-black border border-black py-3 px-8 uppercase tracking-wider text-sm font-semibold hover:opacity-90 transition-opacity'
              >
                CANCEL
              </button>
            </div>
          {%- endform -%}
        </div>

        <!-- Address Edit Forms (hidden by default, one for each address) -->
        {%- for address in customer.addresses -%}
          <div id='AddressEditForm_{{ address.id }}' class='hidden mb-8' data-customer-addresses>
            {%- form 'customer_address', address -%}
              <input type='hidden' name='return_to' value='{{ routes.account_url }}?show=addresses'>
              {%- if form.errors -%}
                <div class='mb-6 p-4 bg-red-50 border border-red-200 text-red-700 text-sm'>
                  <h3 class='font-semibold mb-2'>{{ 'templates.contact.form.error_heading' | t }}</h3>
                  <ul class='list-disc list-inside'>
                    {%- for field in form.errors -%}
                      <li>
                        {%- if field == 'form' -%}
                          {{ form.errors.messages[field] }}
                        {%- else -%}
                          {{ form.errors.translated_fields[field] | capitalize }}
                          {{ form.errors.messages[field] }}
                        {%- endif -%}
                      </li>
                    {%- endfor -%}
                  </ul>
                </div>
              {%- endif -%}

              {%- if form.posted_successfully? -%}
                <div class='mb-6 p-4 bg-green-50 border border-green-200 text-green-700 text-sm'>
                  {{ 'customer.addresses.update' | t | default: 'Address updated successfully.' }}
                </div>
              {%- endif -%}

              <h1 class='text-lg md:text-xl font-bold uppercase tracking-wider mb-6'>EDIT ADDRESS</h1>

              <div class='grid grid-cols-1 md:grid-cols-2 gap-4 mb-4'>
                <!-- First Name -->
                <div>
                  <label for='AddressFirstName_{{ form.id }}' class='block text-sm font-medium mb-2'>
                    {{ 'customer.addresses.first_name' | t }}
                  </label>
                  <input
                    type='text'
                    id='AddressFirstName_{{ form.id }}'
                    name='address[first_name]'
                    value='{{ form.first_name }}'
                    autocomplete='given-name'
                    class='w-full px-4 py-4 bg-gray-50 focus:outline-none'
                  >
                </div>

                <!-- Last Name -->
                <div>
                  <label for='AddressLastName_{{ form.id }}' class='block text-sm font-medium mb-2'>
                    {{ 'customer.addresses.last_name' | t }}
                  </label>
                  <input
                    type='text'
                    id='AddressLastName_{{ form.id }}'
                    name='address[last_name]'
                    value='{{ form.last_name }}'
                    autocomplete='family-name'
                    class='w-full px-4 py-4 bg-gray-50 focus:outline-none'
                  >
                </div>
              </div>

              <!-- Company -->
              <div class='mb-4'>
                <label for='AddressCompany_{{ form.id }}' class='block text-sm font-medium mb-2'>
                  {{ 'customer.addresses.company' | t }}
                </label>
                <input
                  type='text'
                  id='AddressCompany_{{ form.id }}'
                  name='address[company]'
                  value='{{ form.company }}'
                  autocomplete='organization'
                  class='w-full px-4 py-4 bg-gray-50 focus:outline-none'
                >
              </div>

              <!-- Address Line 1 -->
              <div class='mb-4'>
                <label for='AddressAddress1_{{ form.id }}' class='block text-sm font-medium mb-2'>
                  {{ 'customer.addresses.address1' | t }}
                </label>
                <input
                  type='text'
                  id='AddressAddress1_{{ form.id }}'
                  name='address[address1]'
                  value='{{ form.address1 }}'
                  autocomplete='address-line1'
                  class='w-full px-4 py-4 bg-gray-50 focus:outline-none'
                >
              </div>

              <!-- Address Line 2 -->
              <div class='mb-4'>
                <label for='AddressAddress2_{{ form.id }}' class='block text-sm font-medium mb-2'>
                  {{ 'customer.addresses.address2' | t }}
                </label>
                <input
                  type='text'
                  id='AddressAddress2_{{ form.id }}'
                  name='address[address2]'
                  value='{{ form.address2 }}'
                  autocomplete='address-line2'
                  class='w-full px-4 py-4 bg-gray-50 focus:outline-none'
                >
              </div>

              <div class='grid grid-cols-1 md:grid-cols-2 gap-4 mb-4'>
                <!-- City -->
                <div>
                  <label for='AddressCity_{{ form.id }}' class='block text-sm font-medium mb-2'>
                    {{ 'customer.addresses.city' | t }}
                  </label>
                  <input
                    type='text'
                    id='AddressCity_{{ form.id }}'
                    name='address[city]'
                    value='{{ form.city }}'
                    autocomplete='address-level2'
                    class='w-full px-4 py-4 bg-gray-50 focus:outline-none'
                  >
                </div>

                <!-- Country -->
                <div>
                  <label for='AddressCountry_{{ form.id }}' class='block text-sm font-medium mb-2'>
                    {{ 'customer.addresses.country' | t }}
                  </label>
                  <select
                    id='AddressCountry_{{ form.id }}'
                    name='address[country]'
                    data-default='{{ form.country }}'
                    autocomplete='country'
                    class='w-full px-4 py-4 bg-gray-50 focus:outline-none'
                    data-address-country-select
                    data-form-id='{{ form.id }}'
                  >
                    {{ all_country_option_tags }}
                  </select>
                </div>
              </div>

              <!-- Province -->
              <div id='AddressProvinceContainer_{{ form.id }}' class='mb-4' style='display: none'>
                <label for='AddressProvince_{{ form.id }}' class='block text-sm font-medium mb-2'>
                  {{ 'customer.addresses.province' | t }}
                </label>
                <select
                  id='AddressProvince_{{ form.id }}'
                  name='address[province]'
                  data-default='{{ form.province }}'
                  autocomplete='address-level1'
                  class='w-full px-4 py-4 bg-gray-50 focus:outline-none'
                ></select>
              </div>

              <!-- Zip/Postal Code -->
              <div class='mb-4'>
                <label for='AddressZip_{{ form.id }}' class='block text-sm font-medium mb-2'>
                  {{ 'customer.addresses.zip' | t }}
                </label>
                <input
                  type='text'
                  id='AddressZip_{{ form.id }}'
                  name='address[zip]'
                  value='{{ form.zip }}'
                  autocapitalize='characters'
                  autocomplete='postal-code'
                  class='w-full px-4 py-4 bg-gray-50 focus:outline-none'
                >
              </div>

              <!-- Phone -->
              <div class='mb-4'>
                <label for='AddressPhone_{{ form.id }}' class='block text-sm font-medium mb-2'>
                  {{ 'customer.addresses.phone' | t }}
                </label>
                <input
                  type='tel'
                  id='AddressPhone_{{ form.id }}'
                  name='address[phone]'
                  value='{{ form.phone }}'
                  autocomplete='tel'
                  placeholder='{{ 'customer.addresses.phone' | t }}'
                  class='w-full px-4 py-4 bg-gray-50 focus:outline-none'
                >
              </div>

              <!-- Set as default address -->
              <div class='mb-4'>
                <label class='flex items-center'>
                  <input
                    type='checkbox'
                    id='address_default_address_{{ form.id }}'
                    name='address[default]'
                    value='1'
                    {% if address.id == customer.default_address.id %}
                      checked
                    {% endif %}
                    class='mr-2'
                  >
                  <span class='text-sm'>{{ 'customer.addresses.set_default' | t }}</span>
                </label>
              </div>

              <!-- Buttons -->
              <div class='flex gap-4 mt-6'>
                <button
                  type='submit'
                  class='bg-black text-white py-3 px-8 uppercase tracking-wider text-sm font-semibold hover:opacity-90 transition-opacity'
                >
                  UPDATE ADDRESS
                </button>
                <button
                  type='button'
                  onclick='closeAddressEditForm({{ address.id }}, event)'
                  class='bg-white text-black border border-black py-3 px-8 uppercase tracking-wider text-sm font-semibold hover:opacity-90 transition-opacity'
                >
                  CANCEL
                </button>
              </div>
            {%- endform -%}
          </div>
        {%- endfor -%}

        <!-- Account Edit Form (hidden by default) -->
        <div id='AccountEditForm' class='hidden mb-8'>
          {%- form 'customer', class: 'account-edit-form' -%}
            {%- if form.errors -%}
              <div class='mb-6 p-4 bg-red-50 border border-red-200 text-red-700 text-sm'>
                <h3 class='font-semibold mb-2'>{{ 'templates.contact.form.error_heading' | t }}</h3>
                <ul class='list-disc list-inside'>
                  {%- for field in form.errors -%}
                    <li>
                      {%- if field == 'form' -%}
                        {{ form.errors.messages[field] }}
                      {%- else -%}
                        {{ form.errors.translated_fields[field] | capitalize }}
                        {{ form.errors.messages[field] }}
                      {%- endif -%}
                    </li>
                  {%- endfor -%}
                </ul>
              </div>
            {%- endif -%}

            {%- if form.posted_successfully? -%}
              <div class='mb-6 p-4 bg-green-50 border border-green-200 text-green-700 text-sm'>
                {{ 'customer.account.details_updated' | t | default: 'Account details updated successfully.' }}
              </div>
            {%- endif -%}

            <div class='grid grid-cols-1 md:grid-cols-2 gap-4 mb-4'>
              <!-- First Name -->
              <div>
                <label for='AccountEditFirstName' class='block text-sm font-medium mb-2'>
                  {{ 'customer.register.first_name' | t }}
                </label>
                <input
                  type='text'
                  name='customer[first_name]'
                  id='AccountEditFirstName'
                  value='{{ form.first_name | default: customer.first_name }}'
                  autocomplete='given-name'
                  class='w-full px-4 py-4 bg-gray-50 focus:outline-none'
                >
              </div>

              <!-- Last Name -->
              <div>
                <label for='AccountEditLastName' class='block text-sm font-medium mb-2'>
                  {{ 'customer.register.last_name' | t }}
                </label>
                <input
                  type='text'
                  name='customer[last_name]'
                  id='AccountEditLastName'
                  value='{{ form.last_name | default: customer.last_name }}'
                  autocomplete='family-name'
                  class='w-full px-4 py-4 bg-gray-50 focus:outline-none'
                >
              </div>
            </div>

            <div class='grid grid-cols-1 md:grid-cols-2 gap-4 mb-4'>
              <!-- Email -->
              <div>
                <label for='AccountEditEmail' class='block text-sm font-medium mb-2'>
                  {{ 'customer.login_page.email' | t }}
                </label>
                <input
                  type='email'
                  name='customer[email]'
                  id='AccountEditEmail'
                  value='{{ form.email | default: customer.email }}'
                  autocomplete='email'
                  class='w-full px-4 py-4 bg-gray-50 focus:outline-none'
                >
              </div>

              <!-- Shoe Size -->
              <div>
                <label for='AccountEditShoeSize' class='block text-sm font-medium mb-2'> Shoe Size </label>
                <input
                  type='text'
                  name='customer[note]'
                  id='AccountEditShoeSize'
                  value='{{ customer.note }}'
                  class='w-full px-4 py-4 bg-gray-50 focus:outline-none'
                  placeholder='Enter shoe size'
                >
              </div>
            </div>

            <!-- Update Password Checkbox -->
            <div class='mb-4'>
              <label class='flex items-center'>
                <input
                  type='checkbox'
                  id='UpdatePasswordCheckbox'
                  name='customer[password_update]'
                  class='mr-2'
                  onchange='togglePasswordField(this)'
                >
                <span class='text-sm'>Update Password</span>
              </label>
            </div>

            <!-- Password Field (hidden by default) -->
            <div id='PasswordField' class='mb-4 hidden'>
              <label for='AccountEditPassword' class='block text-sm font-medium mb-2'>
                {{ 'customer.login_page.password' | t }}
              </label>
              <input
                type='password'
                name='customer[password]'
                id='AccountEditPassword'
                autocomplete='new-password'
                class='w-full px-4 py-4 bg-gray-50 focus:outline-none'
                placeholder='{{ 'customer.login_page.password' | t }}'
              >
            </div>

            <!-- Buttons -->
            <div class='flex gap-4 mt-6'>
              <button
                type='submit'
                class='bg-black text-white py-3 px-8 uppercase tracking-wider text-sm font-semibold hover:opacity-90 transition-opacity'
              >
                UPDATE
              </button>
              <button
                type='button'
                onclick='toggleAccountEditForm(event)'
                class='bg-white text-black border border-black py-3 px-8 uppercase tracking-wider text-sm font-semibold hover:opacity-90 transition-opacity'
              >
                CANCEL
              </button>
            </div>
          {%- endform -%}
        </div>

        <!-- Account Details Summary (hidden by default) -->
        <div id='AccountDetailsSummary' class='hidden'>
          <h1 class='text-lg md:text-xl font-bold uppercase tracking-wider mb-6'>
            {{ 'customer.account.details' | t }}
          </h1>
          <div class='space-y-4'>
            <div class='flex items-start'>
              <span class='text-sm font-semibold uppercase tracking-wider min-w-[120px]'>First Name:</span>
              <span class='text-sm'>{{ customer.first_name }}</span>
            </div>
            <div class='flex items-start'>
              <span class='text-sm font-semibold uppercase tracking-wider min-w-[120px]'>Last Name:</span>
              <span class='text-sm'>{{ customer.last_name }}</span>
            </div>
            <div class='flex items-start'>
              <span class='text-sm font-semibold uppercase tracking-wider min-w-[120px]'>Email:</span>
              <span class='text-sm'>{{ customer.email }}</span>
            </div>
            <div class='flex items-start'>
              <span class='text-sm font-semibold uppercase tracking-wider min-w-[120px]'>Shoe Size:</span>
              <span class='text-sm'>{{ customer.note | default: 'Not set' }}</span>
            </div>
            <div class='md:hidden'>
              <a
                href='#'
                onclick='toggleAccountEditForm(event)'
                class='underline text-sm hover:opacity-70 transition-opacity'
              >
                Edit
              </a>
            </div>
          </div>
        </div>

        <!-- Addresses List (hidden by default, shown if show=addresses in URL) -->
        <div
          id='AddressesList'
          class='{% if request.query_parameters.show == 'addresses' %}{% else %}hidden{% endif %}'
        >
          <h1 class='text-lg md:text-xl font-bold uppercase tracking-wider mb-6'>
            {{ 'customer.account.addresses' | t }}
          </h1>
          {%- if customer.addresses.size > 0 -%}
            <div class='overflow-x-auto'>
              <table role='table' class='w-full border-collapse'>
                <thead>
                  <tr class='border-b border-gray-200'>
                    <th
                      scope='col'
                      class='text-left py-3 pl-0 md:pl-4 pr-4 text-sm font-semibold uppercase tracking-wider'
                    >
                      Address
                    </th>
                    <th scope='col' class='text-left py-3 px-4 text-sm font-semibold uppercase tracking-wider'>
                      Default
                    </th>
                    <th scope='col' class='text-left py-3 px-4 text-sm font-semibold uppercase tracking-wider'>
                      Actions
                    </th>
                  </tr>
                </thead>
                <tbody>
                  {%- for address in customer.addresses -%}
                    <tr class='border-b border-gray-100 hover:bg-gray-50 transition-colors'>
                      <td class='py-3 pl-0 md:pl-4 pr-4 text-sm'>
                        <div class='space-y-1'>
                          <div class='font-semibold'>
                            {{ address.first_name }}
                            {{ address.last_name }}
                          </div>
                          {%- if address.company -%}
                            <div>{{ address.company }}</div>
                          {%- endif -%}
                          <div>{{ address.address1 }}</div>
                          {%- if address.address2 -%}
                            <div>{{ address.address2 }}</div>
                          {%- endif -%}
                          <div>
                            {{ address.city -}}
                            {%- if address.province %} {{ address.province }}{% endif %}
                            {{ address.zip }}
                          </div>
                          <div>{{ address.country }}</div>
                          {%- if address.phone -%}
                            <div>{{ address.phone }}</div>
                          {%- endif -%}
                        </div>
                      </td>
                      <td class='py-3 px-4 text-sm'>
                        {%- if address.id == customer.default_address.id -%}
                          <span class='font-semibold'>Yes</span>
                        {%- else -%}
                          No
                        {%- endif -%}
                      </td>
                      <td class='py-3 pl-4 pr-0 md:pr-4 text-sm'>
                        <div class='flex gap-4'>
                          <a
                            href='#'
                            onclick='editAddressById({{ address.id }}, event)'
                            class='underline hover:no-underline'
                          >
                            Edit
                          </a>
                          {%- unless address.id == customer.default_address.id -%}
                            <form
                              method='post'
                              action='{{ address.url }}'
                              class='inline'
                              onsubmit="return confirm('{{ 'customer.addresses.delete_confirm' | t }}');"
                            >
                              <input type='hidden' name='_method' value='delete'>
                              <button type='submit' class='underline hover:no-underline text-left'>Delete</button>
                            </form>
                          {%- endunless -%}
                        </div>
                      </td>
                    </tr>
                  {%- endfor -%}
                </tbody>
              </table>
            </div>
          {%- else -%}
            <p class='text-sm text-gray-600'>No addresses on file</p>
          {%- endif -%}
        </div>

        <!-- Order History (shown by default, hidden if show=addresses in URL) -->
        <div id='OrderHistory' class='{% if request.query_parameters.show == 'addresses' %}hidden{% endif %}'>
          <h1 class='text-lg md:text-xl font-bold uppercase tracking-wider mb-6'>
            {{ 'customer.orders.title' | t }}
          </h1>

          {% paginate customer.orders by 20 %}
            {%- if customer.orders.size > 0 -%}
              <div class='overflow-x-auto'>
                <table role='table' class='w-full border-collapse'>
                  <thead>
                    <tr class='border-b border-gray-200'>
                      <th scope='col' class='text-left py-3 px-4 text-sm font-semibold uppercase tracking-wider'>
                        {{ 'customer.orders.order_number' | t }}
                      </th>
                      <th scope='col' class='text-left py-3 px-4 text-sm font-semibold uppercase tracking-wider'>
                        {{ 'customer.orders.date' | t }}
                      </th>
                      <th scope='col' class='text-left py-3 px-4 text-sm font-semibold uppercase tracking-wider'>
                        {{ 'customer.orders.payment_status' | t }}
                      </th>
                      <th scope='col' class='text-left py-3 px-4 text-sm font-semibold uppercase tracking-wider'>
                        {{ 'customer.orders.fulfillment_status' | t }}
                      </th>
                      <th scope='col' class='text-left py-3 px-4 text-sm font-semibold uppercase tracking-wider'>
                        {{ 'customer.orders.total' | t }}
                      </th>
                    </tr>
                  </thead>
                  <tbody>
                    {%- for order in customer.orders -%}
                      <tr class='border-b border-gray-100 hover:bg-gray-50 transition-colors'>
                        <td class='py-3 px-4 text-sm'>
                          <a href='{{ order.customer_url }}' class='underline hover:no-underline'>
                            {{ order.name }}
                          </a>
                        </td>
                        <td class='py-3 px-4 text-sm'>
                          {{ order.created_at | time_tag: format: 'date' }}
                        </td>
                        <td class='py-3 px-4 text-sm'>
                          {{ order.financial_status_label }}
                        </td>
                        <td class='py-3 px-4 text-sm'>
                          {{ order.fulfillment_status_label }}
                        </td>
                        <td class='py-3 px-4 text-sm font-semibold'>
                          {{ order.total_net_amount | money_with_currency }}
                        </td>
                      </tr>
                    {%- endfor -%}
                  </tbody>
                </table>
              </div>
            {%- else -%}
              <p class='text-sm text-gray-600'>
                {{ 'customer.orders.none' | t | default: 'You have not placed any orders yet.' }}
              </p>
            {%- endif -%}

            {%- if paginate.pages > 1 -%}
              <nav class='mt-8 flex justify-center' role='navigation' aria-label='{{ 'general.pagination.label' | t }}'>
                <ul class='flex items-center space-x-2'>
                  {%- if paginate.previous -%}
                    <li>
                      <a
                        href='{{ paginate.previous.url }}'
                        class='px-3 py-2 text-sm underline hover:no-underline'
                        aria-label='{{ 'general.pagination.previous' | t }}'
                      >
                        ←
                      </a>
                    </li>
                  {%- endif -%}

                  {%- for part in paginate.parts -%}
                    <li>
                      {%- if part.is_link -%}
                        <a
                          href='{{ part.url }}'
                          class='px-3 py-2 text-sm underline hover:no-underline'
                          aria-label='{{ 'general.pagination.page' | t: number: part.title }}'
                        >
                          {{ part.title }}
                        </a>
                      {%- else -%}
                        {%- if part.title == paginate.current_page -%}
                          <span
                            class='px-3 py-2 text-sm font-semibold'
                            aria-current='page'
                            aria-label='{{ 'general.pagination.page' | t: number: part.title }}'
                          >
                            {{ part.title }}
                          </span>
                        {%- else -%}
                          <span class='px-3 py-2 text-sm'>{{ part.title }}</span>
                        {%- endif -%}
                      {%- endif -%}
                    </li>
                  {%- endfor -%}

                  {%- if paginate.next -%}
                    <li>
                      <a
                        href='{{ paginate.next.url }}'
                        class='px-3 py-2 text-sm underline hover:no-underline'
                        aria-label='{{ 'general.pagination.next' | t }}'
                      >
                        →
                      </a>
                    </li>
                  {%- endif -%}
                </ul>
              </nav>
            {%- endif -%}
          {% endpaginate %}
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // Check if we should show addresses list on page load
  function showAddressesListIfNeeded() {
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get('show') === 'addresses') {
      // Small delay to ensure all elements are loaded
      setTimeout(function() {
        const addressesList = document.getElementById('AddressesList');
        const orderHistory = document.getElementById('OrderHistory');
        if (addressesList && orderHistory) {
          addressesList.classList.remove('hidden');
          orderHistory.classList.add('hidden');
        }
      }, 100);
    }
  }

  // Listen for both DOMContentLoaded and Turbo events
  document.addEventListener('DOMContentLoaded', showAddressesListIfNeeded);
  document.addEventListener('turbo:load', showAddressesListIfNeeded);

  // Helper function to hide all address edit forms
  function hideAllAddressEditForms() {
    const allEditForms = document.querySelectorAll('[id^="AddressEditForm_"]');
    allEditForms.forEach(function(form) {
      if (form && !form.classList.contains('hidden')) {
        form.classList.add('hidden');
      }
    });
  }

  // Helper function to initialize province selectors for a form
  function initializeProvinceSelector(formId) {
    if (Shopify && Shopify.CountryProvinceSelector) {
      const countrySelect = document.getElementById('AddressCountry_' + formId);
      const provinceSelect = document.getElementById('AddressProvince_' + formId);
      const provinceContainer = document.getElementById('AddressProvinceContainer_' + formId);

      if (countrySelect && provinceSelect && provinceContainer) {
        // Check if already initialized
        if (!countrySelect.dataset.initialized) {
          // eslint-disable-next-line no-new
          new Shopify.CountryProvinceSelector(
            'AddressCountry_' + formId,
            'AddressProvince_' + formId,
            {
              hideElement: 'AddressProvinceContainer_' + formId,
            }
          );
          countrySelect.dataset.initialized = 'true';
        } else {
          // Re-initialize if needed
          const countryValue = countrySelect.getAttribute('data-default');
          if (countryValue) {
            Shopify.setSelectorByValue(countrySelect, countryValue);
            const event = new Event('change');
            countrySelect.dispatchEvent(event);
          }
        }
      }
    }
  }

  function toggleAccountDetails(event) {
    if (event) {
      event.preventDefault();
      event.stopPropagation();
      event.stopImmediatePropagation();
    }
    const accountDetailsSummary = document.getElementById('AccountDetailsSummary');
    const accountEditForm = document.getElementById('AccountEditForm');
    const addressesList = document.getElementById('AddressesList');
    const addAddressForm = document.getElementById('AddAddressForm');
    const orderHistory = document.getElementById('OrderHistory');

    if (!accountDetailsSummary) return;

    // Hide all address edit forms
    hideAllAddressEditForms();

    // Hide other forms/views if visible
    if (accountEditForm && !accountEditForm.classList.contains('hidden')) {
      accountEditForm.classList.add('hidden');
    }
    if (addressesList && !addressesList.classList.contains('hidden')) {
      addressesList.classList.add('hidden');
    }
    if (addAddressForm && !addAddressForm.classList.contains('hidden')) {
      addAddressForm.classList.add('hidden');
    }

    if (accountDetailsSummary.classList.contains('hidden')) {
      accountDetailsSummary.classList.remove('hidden');
      if (orderHistory) {
        orderHistory.classList.add('hidden');
      }
    } else {
      accountDetailsSummary.classList.add('hidden');
      if (orderHistory) {
        orderHistory.classList.remove('hidden');
      }
    }
  }

  function toggleAccountEditForm(event) {
    event.preventDefault();
    const editForm = document.getElementById('AccountEditForm');
    const accountDetailsSummary = document.getElementById('AccountDetailsSummary');
    const addressesList = document.getElementById('AddressesList');
    const addAddressForm = document.getElementById('AddAddressForm');
    const orderHistory = document.getElementById('OrderHistory');

    // Hide all address edit forms
    hideAllAddressEditForms();

    // Hide other forms/views if visible
    if (accountDetailsSummary && !accountDetailsSummary.classList.contains('hidden')) {
      accountDetailsSummary.classList.add('hidden');
    }
    if (addressesList && !addressesList.classList.contains('hidden')) {
      addressesList.classList.add('hidden');
    }
    if (addAddressForm && !addAddressForm.classList.contains('hidden')) {
      addAddressForm.classList.add('hidden');
    }

    if (editForm.classList.contains('hidden')) {
      editForm.classList.remove('hidden');
      if (orderHistory) {
        orderHistory.classList.add('hidden');
      }
    } else {
      editForm.classList.add('hidden');
      if (orderHistory) {
        orderHistory.classList.remove('hidden');
      }
    }
  }

  function toggleAddressesList(event) {
    event.preventDefault();
    try {
      const addressesList = document.getElementById('AddressesList');
      const addAddressForm = document.getElementById('AddAddressForm');
      const accountEditForm = document.getElementById('AccountEditForm');
      const accountDetailsSummary = document.getElementById('AccountDetailsSummary');
      const orderHistory = document.getElementById('OrderHistory');

      if (!addressesList) {
        console.error('AddressesList element not found');
        return;
      }

      // Hide all address edit forms
      hideAllAddressEditForms();

      // Hide other forms/views if visible
      if (addAddressForm && !addAddressForm.classList.contains('hidden')) {
        addAddressForm.classList.add('hidden');
      }
      if (accountEditForm && !accountEditForm.classList.contains('hidden')) {
        accountEditForm.classList.add('hidden');
      }
      if (accountDetailsSummary && !accountDetailsSummary.classList.contains('hidden')) {
        accountDetailsSummary.classList.add('hidden');
      }

      if (addressesList.classList.contains('hidden')) {
        addressesList.classList.remove('hidden');
        if (orderHistory) {
          orderHistory.classList.add('hidden');
        }
      } else {
        addressesList.classList.add('hidden');
        if (orderHistory) {
          orderHistory.classList.remove('hidden');
        }
      }
    } catch (error) {
      console.error('Error in toggleAddressesList:', error);
    }
  }

  function editAddressById(addressId, event) {
    event.preventDefault();
    const addressEditForm = document.getElementById('AddressEditForm_' + addressId);
    const addressesList = document.getElementById('AddressesList');
    const addAddressForm = document.getElementById('AddAddressForm');
    const accountEditForm = document.getElementById('AccountEditForm');
    const orderHistory = document.getElementById('OrderHistory');

    if (!addressEditForm) return;

    // Hide all other address edit forms first
    hideAllAddressEditForms();

    // Hide other forms/views if visible
    if (addressesList && !addressesList.classList.contains('hidden')) {
      addressesList.classList.add('hidden');
    }
    if (addAddressForm && !addAddressForm.classList.contains('hidden')) {
      addAddressForm.classList.add('hidden');
    }
    if (accountEditForm && !accountEditForm.classList.contains('hidden')) {
      accountEditForm.classList.add('hidden');
    }

    // Show the specific address edit form
    addressEditForm.classList.remove('hidden');
    if (orderHistory) {
      orderHistory.classList.add('hidden');
    }

    // Initialize province selector for this form
    const formId = addressEditForm.querySelector('[data-form-id]')?.dataset.formId;
    if (formId) {
      // Small delay to ensure DOM is ready
      setTimeout(function() {
        initializeProvinceSelector(formId);
      }, 100);
    }
  }

  function toggleAddAddressForm(event) {
    if (event) {
      event.preventDefault();
      event.stopPropagation();
      event.stopImmediatePropagation();
    }
    const addAddressForm = document.getElementById('AddAddressForm');
    const addressesList = document.getElementById('AddressesList');
    const accountEditForm = document.getElementById('AccountEditForm');
    const orderHistory = document.getElementById('OrderHistory');

    if (!addAddressForm) return;

    // Hide all address edit forms
    hideAllAddressEditForms();

    // Hide other forms/views if visible
    if (addressesList && !addressesList.classList.contains('hidden')) {
      addressesList.classList.add('hidden');
    }
    if (accountEditForm && !accountEditForm.classList.contains('hidden')) {
      accountEditForm.classList.add('hidden');
    }

    if (addAddressForm.classList.contains('hidden')) {
      addAddressForm.classList.remove('hidden');
      if (orderHistory) {
        orderHistory.classList.add('hidden');
      }
    } else {
      addAddressForm.classList.add('hidden');
      if (orderHistory) {
        orderHistory.classList.remove('hidden');
      }
    }
  }

  function toggleAddressEditForm(event) {
    event.preventDefault();
    // Find the default address edit form
    {%- if customer.default_address -%}
      const addressEditForm = document.getElementById('AddressEditForm_{{ customer.default_address.id }}');
      const addressesList = document.getElementById('AddressesList');
      const addAddressForm = document.getElementById('AddAddressForm');
      const accountEditForm = document.getElementById('AccountEditForm');
      const orderHistory = document.getElementById('OrderHistory');

      if (!addressEditForm) return;

      // Hide all other address edit forms first
      hideAllAddressEditForms();

      // Hide other forms/views if visible
      if (addressesList && !addressesList.classList.contains('hidden')) {
        addressesList.classList.add('hidden');
      }
      if (addAddressForm && !addAddressForm.classList.contains('hidden')) {
        addAddressForm.classList.add('hidden');
      }
      if (accountEditForm && !accountEditForm.classList.contains('hidden')) {
        accountEditForm.classList.add('hidden');
      }

      if (addressEditForm.classList.contains('hidden')) {
        addressEditForm.classList.remove('hidden');
        if (orderHistory) {
          orderHistory.classList.add('hidden');
        }

        // Initialize province selector for this form
        const formId = addressEditForm.querySelector('[data-form-id]')?.dataset.formId;
        if (formId) {
          // Small delay to ensure DOM is ready
          setTimeout(function() {
            initializeProvinceSelector(formId);
          }, 100);
        }
      } else {
        addressEditForm.classList.add('hidden');
        if (orderHistory) {
          orderHistory.classList.remove('hidden');
        }
      }
    {%- else -%}
      // No default address, do nothing
      return;
    {%- endif -%}
  }

  function closeAddressEditForm(addressId, event) {
    event.preventDefault();
    const addressEditForm = document.getElementById('AddressEditForm_' + addressId);
    const orderHistory = document.getElementById('OrderHistory');

    if (addressEditForm) {
      addressEditForm.classList.add('hidden');
      orderHistory.classList.remove('hidden');
    }
  }

  function togglePasswordField(checkbox) {
    const passwordField = document.getElementById('PasswordField');
    const passwordInput = document.getElementById('AccountEditPassword');

    if (checkbox.checked) {
      passwordField.classList.remove('hidden');
      passwordInput.setAttribute('required', 'required');
    } else {
      passwordField.classList.add('hidden');
      passwordInput.removeAttribute('required');
      passwordInput.value = '';
    }
  }

  // Make functions globally accessible
  window.toggleAccountDetails = toggleAccountDetails;
  window.toggleAccountEditForm = toggleAccountEditForm;
  window.toggleAddressesList = toggleAddressesList;
  window.editAddressById = editAddressById;
  window.toggleAddAddressForm = toggleAddAddressForm;
  window.closeAddressEditForm = closeAddressEditForm;
  window.togglePasswordField = togglePasswordField;

  // Initialize event listeners after DOM is ready
  function initializeAccountEventListeners() {
    // Account Details link
    const accountDetailsLink = document.querySelector('a[onclick*="toggleAccountDetails"]');
    if (accountDetailsLink) {
      accountDetailsLink.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        toggleAccountDetails(e);
        return false;
      });
    }

    // Add New Address links
    const addAddressLinks = document.querySelectorAll('a[onclick*="toggleAddAddressForm"]');
    addAddressLinks.forEach(function(link) {
      link.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        toggleAddAddressForm(e);
        return false;
      });
    });
  }

  // Initialize on page load
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initializeAccountEventListeners);
  } else {
    initializeAccountEventListeners();
  }

  // Re-initialize on Turbo navigation
  document.addEventListener('turbo:load', initializeAccountEventListeners);
</script>

{% schema %}
{
  "name": "t:sections.main-account.name",
  "settings": [
    {
      "type": "header",
      "content": "t:sections.all.padding.section_padding_heading"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_top",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_bottom",
      "default": 36
    }
  ]
}
{% endschema %}
