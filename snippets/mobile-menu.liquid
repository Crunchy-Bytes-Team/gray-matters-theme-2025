{% assign mobile_collection_menu = linklists.collection %}

<nav class='mobile-menu space-y-2' aria-label='Mobile menu'>
  <div data-accordion-item>
    <button
      type='button'
      class='menu-drawer__menu-item w-full flex items-center justify-between py-1 pr-0 text-sm tracking-wider uppercase hover:opacity-70 transition-opacity duration-200 ease-out'
      data-accordion-button
      aria-controls='MobileMenuCollection'
      aria-expanded='false'
    >
      <span>Collection</span>
      <span class='ml-auto inline-flex items-center justify-end text-lg leading-none'>
        <span aria-hidden='true' class='inline-block w-4 text-right' data-accordion-plus>+</span>
        <span aria-hidden='true' class='inline-block w-4 text-right hidden' data-accordion-minus>-</span>
      </span>
    </button>
    <div id='MobileMenuCollection' class='hidden pb-3' data-accordion-panel>
      {% if mobile_collection_menu != blank and mobile_collection_menu.links != blank %}
        <ul class='space-y-2'>
          {% for link in mobile_collection_menu.links %}
            <li>
              <a
                href='{{ link.url }}'
                class='menu-drawer__menu-item block py-1 proxima-reg text-sm tracking-wider uppercase hover:opacity-70 transition-opacity duration-200 ease-out'
              >
                {{- link.title | escape -}}
              </a>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <ul class='space-y-2'>
          <li>
            <a
              href='{{ routes.collections_url }}'
              class='menu-drawer__menu-item block py-1 proxima-reg text-sm tracking-wider uppercase hover:opacity-70 transition-opacity duration-200 ease-out'
              >Collection</a
            >
          </li>
        </ul>
      {% endif %}
    </div>
  </div>

  <div data-accordion-item>
    <button
      type='button'
      class='menu-drawer__menu-item w-full flex items-center justify-between py-1 pr-0 text-sm tracking-wider uppercase hover:opacity-70 transition-opacity duration-200 ease-out'
      data-accordion-button
      aria-controls='MobileMenuLanguage'
      aria-expanded='false'
    >
      <span>Select language</span>
      <span class='ml-auto inline-flex items-center justify-end text-lg leading-none'>
        <span aria-hidden='true' class='inline-block w-4 text-right' data-accordion-plus>+</span>
        <span aria-hidden='true' class='inline-block w-4 text-right hidden' data-accordion-minus>-</span>
      </span>
    </button>
    <div id='MobileMenuLanguage' class='hidden pb-3' data-accordion-panel>
      {%- if localization.available_languages and localization.available_languages.size > 1 -%}
        <ul class='space-y-2'>
          {%- for language in localization.available_languages -%}
            <li>
              {%- if language.iso_code == localization.language.iso_code -%}
                <span class='menu-drawer__menu-item block py-1 proxima-reg text-sm tracking-wider uppercase font-semibold text-black hover:opacity-70 transition-opacity duration-200 ease-out'>
                  {{ language.endonym_name | default: language.name }}
                </span>
              {%- else -%}
                <a
                  href='{{ language.root_url }}'
                  hreflang='{{ language.iso_code }}'
                  class='menu-drawer__menu-item block py-1 proxima-reg text-sm tracking-wider uppercase text-gray-500 hover:opacity-70 transition-opacity duration-200 ease-out'
                >
                  {{ language.endonym_name | default: language.name }}
                </a>
              {%- endif -%}
            </li>
          {%- endfor -%}
        </ul>

      {%- else -%}
        <p class='text-sm text-gray-600'>{{ 'localization.language_label' | t }}</p>
      {%- endif -%}
    </div>
  </div>

  <div data-accordion-item>
    <button
      type='button'
      class='menu-drawer__menu-item w-full flex items-center justify-between py-1 pr-0 text-sm tracking-wider uppercase hover:opacity-70 transition-opacity duration-200 ease-out'
      data-accordion-button
      aria-controls='MobileMenuClientService'
      aria-expanded='false'
    >
      <span>Client Service</span>
      <span class='ml-auto inline-flex items-center justify-end text-lg leading-none'>
        <span aria-hidden='true' class='inline-block w-4 text-right' data-accordion-plus>+</span>
        <span aria-hidden='true' class='inline-block w-4 text-right hidden' data-accordion-minus>-</span>
      </span>
    </button>
    <div id='MobileMenuClientService' class='hidden pb-3' data-accordion-panel>
      <a
        href='mailto:hello@graymattersnyc.com'
        class='flex items-center gap-2 py-2 proxima-reg text-xs tracking-wider hover:opacity-70 transition-opacity text-dark-gray'
      >
        <i class='fa-solid fa-envelope text-gray-400' aria-hidden='true'></i>
        <span>Email</span>
      </a>
      <a
        href='tel:+19292950303'
        class='flex items-center gap-2 py-2 proxima-reg text-xs tracking-wider hover:opacity-70 transition-opacity text-dark-gray'
      >
        <i class='fa-solid fa-phone text-gray-400' aria-hidden='true'></i>
        <span>+1 929 295 0303</span>
      </a>
      <span class='block py-1 proxima-reg text-xs tracking-wider text-gray-600'> Lun-Ven 10.00 - 18.00 EST </span>
      <div class='w-full px-4'>
        <div class='border-t border-gray-300 mt-4 mb-2'></div>
      </div>
      <a
        href='#'
        class='block py-2 proxima-reg text-xs tracking-wider uppercase hover:opacity-70 transition-opacity text-dark-gray'
      >
        spedizioni e resi
      </a>
      <a
        href='#'
        class='block py-2 proxima-reg text-xs tracking-wider uppercase hover:opacity-70 transition-opacity text-dark-gray'
      >
        FAQ
      </a>
      <a
        href='#'
        class='block py-2 proxima-reg text-xs tracking-wider uppercase hover:opacity-70 transition-opacity text-dark-gray'
      >
        cura delle scarpe
      </a>
      <a
        href='#'
        class='block py-2 proxima-reg text-xs tracking-wider uppercase hover:opacity-70 transition-opacity text-dark-gray'
      >
        stampa
      </a>
      <a
        href='#'
        class='block py-2 proxima-reg text-xs tracking-wider uppercase hover:opacity-70 transition-opacity text-dark-gray'
      >
        ladygrayu club
      </a>
      <a
        href='#'
        class='block py-2 proxima-reg text-xs tracking-wider uppercase hover:opacity-70 transition-opacity text-dark-gray'
      >
        brand stories
      </a>
    </div>
  </div>
  <ul class='space-y-2 mt-4'>
    <li>
      <span class='menu-drawer__menu-item flex items-center gap-2 py-1 proxima-reg text-sm tracking-wider uppercase hover:opacity-70 transition-opacity duration-200 ease-out'>
        <i class='fa-solid fa-magnifying-glass text-gray-400' aria-hidden='true'></i>
        <input
          class='search-header__input1 search__input1 form-control bg-transparent placeholder:text-black'
          type='search'
          name='q'
          id='search_input1'
          placeholder='SEARCH'
          aria-label='{{ 'general.search.placeholder' | t }}'
        >
      </span>
    </li>
    <li>
      <span class='menu-drawer__menu-item flex items-center gap-2 py-1 proxima-reg text-sm tracking-wider hover:opacity-70 transition-opacity duration-200 ease-out'>
        <i class='fa-regular fa-user text-gray-400' aria-hidden='true'></i>
        <a href='{{ routes.account_login_url }}'>Login / Create Account</a>
      </span>
    </li>
    <li>
      <span class='menu-drawer__menu-item flex items-center gap-2 py-1 proxima-reg text-sm tracking-wider hover:opacity-70 transition-opacity duration-200 ease-out'>
        <i class='fa-brands fa-instagram text-gray-400' aria-hidden='true'></i>
        <a href='https://instagram.com/graymattersnyc' target='_blank'>@graymattersnyc</a>
      </span>
    </li>
  </ul>
</nav>

<script>
  (function () {
    var container = document.getElementById('MobileMenu');
    if (!container) return;
    var buttons = container.querySelectorAll('[data-accordion-button]');
    var panels = container.querySelectorAll('[data-accordion-panel]');
    var reduceMotionQuery =
      typeof window.matchMedia === 'function' ? window.matchMedia('(prefers-reduced-motion: reduce)') : null;
    var reduceMotion = reduceMotionQuery ? reduceMotionQuery.matches : false;

    if (!reduceMotion) {
      panels.forEach(function (panel) {
        panel.style.overflow = 'hidden';
        panel.style.maxHeight = '0px';
        panel.style.opacity = '0';
        panel.style.transition = 'max-height 250ms ease-out, opacity 250ms ease-out';
      });
    }

    function toggleIndicators(btn, expanded) {
      var iconWrap = btn.querySelector('[data-accordion-icon]');
      if (iconWrap) {
        var plusIcon = iconWrap.querySelector('[data-icon-plus]');
        var minusIcon = iconWrap.querySelector('[data-icon-minus]');
        if (plusIcon) plusIcon.classList.toggle('hidden', expanded);
        if (minusIcon) minusIcon.classList.toggle('hidden', !expanded);
      }
      var plusText = btn.querySelector('[data-accordion-plus]');
      var minusText = btn.querySelector('[data-accordion-minus]');
      if (plusText) plusText.classList.toggle('hidden', expanded);
      if (minusText) minusText.classList.toggle('hidden', !expanded);
    }

    function openPanel(btn, panel) {
      panel.classList.remove('hidden');
      btn.setAttribute('aria-expanded', 'true');
      toggleIndicators(btn, true);
      if (reduceMotion) return;

      if (panel._accordionCloseHandler) {
        panel.removeEventListener('transitionend', panel._accordionCloseHandler);
        panel._accordionCloseHandler = null;
      }
      if (panel._accordionOpenHandler) {
        panel.removeEventListener('transitionend', panel._accordionOpenHandler);
        panel._accordionOpenHandler = null;
      }

      panel.style.maxHeight = '0px';
      panel.style.opacity = '0';

      requestAnimationFrame(function () {
        panel.style.maxHeight = panel.scrollHeight + 'px';
        panel.style.opacity = '1';
      });

      panel._accordionOpenHandler = function (event) {
        if (event.target !== panel || event.propertyName !== 'max-height') return;
        panel.style.maxHeight = 'none';
        panel.removeEventListener('transitionend', panel._accordionOpenHandler);
        panel._accordionOpenHandler = null;
      };
      panel.addEventListener('transitionend', panel._accordionOpenHandler);
    }

    function closePanel(btn, panel) {
      btn.setAttribute('aria-expanded', 'false');
      toggleIndicators(btn, false);
      if (reduceMotion) {
        panel.classList.add('hidden');
        return;
      }

      if (panel._accordionOpenHandler) {
        panel.removeEventListener('transitionend', panel._accordionOpenHandler);
        panel._accordionOpenHandler = null;
      }
      if (panel._accordionCloseHandler) {
        panel.removeEventListener('transitionend', panel._accordionCloseHandler);
        panel._accordionCloseHandler = null;
      }

      panel.style.maxHeight = panel.scrollHeight + 'px';

      requestAnimationFrame(function () {
        panel.style.maxHeight = '0px';
        panel.style.opacity = '0';
      });

      panel._accordionCloseHandler = function (event) {
        if (event.target !== panel || event.propertyName !== 'max-height') return;
        panel.classList.add('hidden');
        panel.style.maxHeight = '0px';
        panel.removeEventListener('transitionend', panel._accordionCloseHandler);
        panel._accordionCloseHandler = null;
      };
      panel.addEventListener('transitionend', panel._accordionCloseHandler);
    }

    buttons.forEach(function (btn) {
      btn.addEventListener('click', function () {
        var panelId = btn.getAttribute('aria-controls');
        var panel = document.getElementById(panelId);
        if (!panel) return;
        var isHidden = panel.classList.contains('hidden');
        if (isHidden) {
          openPanel(btn, panel);
        } else {
          closePanel(btn, panel);
        }
      });
    });
  })();
</script>
