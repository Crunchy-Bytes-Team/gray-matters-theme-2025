{% comment %} Raccogli le immagini dai metafields {% endcomment %}
{% assign image1 = product.metafields.module.image_row_module_image1.value %}
{% assign image2 = product.metafields.module.image_row_module_image2.value %}
{% assign image3 = product.metafields.module.image_row_module_image3.value %}
{% assign image4 = product.metafields.module.image_row_module_image4.value %}

{% comment %} Conta le immagini presenti {% endcomment %}
{% assign image_count = 0 %}
{% if image1 %}
  {% assign image_count = image_count | plus: 1 %}
{% endif %}
{% if image2 %}
  {% assign image_count = image_count | plus: 1 %}
{% endif %}
{% if image3 %}
  {% assign image_count = image_count | plus: 1 %}
{% endif %}
{% if image4 %}
  {% assign image_count = image_count | plus: 1 %}
{% endif %}

{% comment %} Determina le classi per le colonne in base al numero di immagini {% endcomment %}
{% if image_count == 2 %}
  {% assign desktop_grid_class = 'md:grid-cols-2' %}
{% elsif image_count == 3 %}
  {% assign desktop_grid_class = 'md:grid-cols-3' %}
{% elsif image_count == 4 %}
  {% assign desktop_grid_class = 'md:grid-cols-4' %}
{% else %}
  {% assign desktop_grid_class = 'md:grid-cols-1' %}
{% endif %}

{% if image_count > 0 %}
  <div class='relative w-full' data-imagerow>
    <!-- Viewport -->
    <div class='overflow-hidden md:overflow-visible w-full' data-viewport>
      <!-- Track (flex on mobile, grid on md+) -->
      <div
        class='flex w-full transition-transform duration-300 ease-in-out md:grid {{ desktop_grid_class }} md:gap-0'
        data-track
      >
        {% if image1 %}
          <div class='relative basis-full md:basis-auto shrink-0' data-item>
            <img
              src='{{ image1 }}'
              alt='Product image 1'
              width='800'
              height='auto'
              class='w-full h-auto object-cover block'
              loading='lazy'
            >
          </div>
        {% endif %}
        {% if image2 %}
          <div class='relative basis-full md:basis-auto shrink-0' data-item>
            <img
              src='{{ image2 }}'
              alt='Product image 2'
              width='800'
              height='auto'
              class='w-full h-auto object-cover block'
              loading='lazy'
            >
          </div>
        {% endif %}
        {% if image3 %}
          <div class='relative basis-full md:basis-auto shrink-0' data-item>
            <img
              src='{{ image3 }}'
              alt='Product image 3'
              width='800'
              height='auto'
              class='w-full h-auto object-cover block'
              loading='lazy'
            >
          </div>
        {% endif %}
        {% if image4 %}
          <div class='relative basis-full md:basis-auto shrink-0' data-item>
            <img
              src='{{ image4 }}'
              alt='Product image 4'
              width='800'
              height='auto'
              class='w-full h-auto object-cover block'
              loading='lazy'
            >
          </div>
        {% endif %}
      </div>
    </div>

    <!-- Controls (mobile only) -->
    {% if image_count > 1 %}
      <button
        type='button'
        class='md:hidden absolute left-2 top-1/2 -translate-y-1/2 bg-black/70 text-white rounded-full w-9 h-9 flex items-center justify-center'
        aria-label='Previous'
        data-prev
      >
        ‹
      </button>
      <button
        type='button'
        class='md:hidden absolute right-2 top-1/2 -translate-y-1/2 bg-black/70 text-white rounded-full w-9 h-9 flex items-center justify-center'
        aria-label='Next'
        data-next
      >
        ›
      </button>

      <!-- Progress bar (appears only during interaction on mobile, on hover on desktop) -->
      <div
        class='absolute left-2 -bottom-3 h-[2px] w-[100px] bg-gray-300 opacity-0 transition-opacity duration-200'
        data-progress
      ></div>
    {% endif %}
  </div>
{% endif %}
