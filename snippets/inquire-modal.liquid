{% comment %}
  Inquire modal for out-of-stock product variants.
  Accepts:
  - product: {Object} product object.

  Usage:
  {% render 'inquire-modal', product: product %}
{% endcomment %}
{%- liquid
  assign size_option_position = 0
  if product.options_with_values.size == 1
    assign size_option_position = 1
  else
    for option in product.options_with_values
      assign opt_name_downcase = option.name | downcase
      if opt_name_downcase contains 'size' or opt_name_downcase contains 'taglia'
        assign size_option_position = option.position
      endif
    endfor
  endif

  assign out_of_stock_variants = product.variants | where: 'available', false
  if size_option_position == 1
    assign size_values_array = out_of_stock_variants | map: 'option1' | uniq
  elsif size_option_position == 2
    assign size_values_array = out_of_stock_variants | map: 'option2' | uniq
  elsif size_option_position == 3
    assign size_values_array = out_of_stock_variants | map: 'option3' | uniq
  else
    assign size_values_array = '' | split: ','
  endif
-%}

<div
  id='inquire-modal'
  class='fixed inset-0 top-24 z-50 hidden overflow-y-auto bg-transparent'
  data-modal='inquire-modal'
  role='dialog'
  aria-modal='true'
  aria-hidden='true'
>
  <div class='flex min-h-full items-center justify-center p-6'>
    <div
      class='relative w-full max-w-lg rounded-lg bg-white shadow-2xl ring-1 ring-black/5 transition-all'
      data-modal-content
      tabindex='-1'
    >
      <button
        type='button'
        class='absolute right-4 top-4 inline-flex h-12 w-12 items-center justify-center text-gray-700 transition hover:text-gray-900 focus:outline-none focus:ring-2 focus:ring-black/20'
        aria-label='{{ 'accessibility.close' | t }}'
        data-modal-dismiss
      >
        <span class='text-2xl leading-none font-light' aria-hidden='true'>&times;</span>
      </button>

      <div class='max-h-[80vh] p-6 overflow-hidden flex flex-col'>
        <header class='mb-4'>
          <h2 class='uppercase text-lg font-medium text-gray-900 pr-10'>{{ product.title | escape }}</h2>
        </header>

        <div class='inquire-modal__scroll overflow-y-auto min-h-0 flex-1'>
          <p class='text-sm text-gray-600 mb-6'>
            {{ 'templates.contact.form.inquire_intro' | t }}
          </p>

          {%- form 'contact', id: 'InquireContactForm', class: 'space-y-4' -%}
            <input type='hidden' name='form_type' value='contact'>
            <input type='hidden' name='utf8' value='âœ“'>
            <input type='hidden' name='contact[Product Name]' value='{{ product.title | escape }}'>

            <div class='grid grid-cols-1 sm:grid-cols-2 gap-4'>
              <div class='field'>
                <input
                  type='text'
                  id='InquireContactForm-first-name'
                  name='contact[First name]'
                  class='w-full px-3 py-2 bg-slate-100 border border-transparent focus:border-black focus:outline-none focus:ring-0'
                  autocomplete='given-name'
                  placeholder='{{ 'templates.contact.form.first_name' | t }}'
                  aria-label='{{ 'templates.contact.form.first_name' | t }}'
                >
              </div>
              <div class='field'>
                <input
                  type='text'
                  id='InquireContactForm-last-name'
                  name='contact[Last name]'
                  class='w-full px-3 py-2 bg-slate-100 border border-transparent focus:border-black focus:outline-none focus:ring-0'
                  autocomplete='family-name'
                  placeholder='{{ 'templates.contact.form.last_name' | t }}'
                  aria-label='{{ 'templates.contact.form.last_name' | t }}'
                >
              </div>
            </div>

            <div class='field'>
              <input
                type='email'
                id='InquireContactForm-email'
                name='contact[email]'
                class='w-full px-3 py-2 bg-slate-100 border border-transparent focus:border-black focus:outline-none focus:ring-0'
                autocomplete='email'
                required
                aria-required='true'
                placeholder='{{ 'templates.contact.form.email' | t }}'
                aria-label='{{ 'templates.contact.form.email' | t }}'
              >
            </div>

            <div class='field'>
              <select
                id='InquireContactForm-size'
                name='contact[Size]'
                class='w-full px-3 py-2 bg-slate-100 border border-transparent focus:border-black focus:outline-none focus:ring-0'
                aria-label='{{ 'templates.contact.form.requested_size' | t }}'
              >
                <option value=''>{{ 'templates.contact.form.requested_size' | t }}</option>
                {%- for size_val in size_values_array -%}
                  {%- if size_val != '' -%}
                    <option value='{{ size_val | escape }}'>{{ size_val }} - {{ 'products.product.inquire' | t }}</option>
                  {%- endif -%}
                {%- endfor -%}
              </select>
            </div>

            <div class='pt-2'>
              <button
                type='submit'
                class='uppercase w-full px-6 py-3 bg-gray-900 text-white border border-gray-900 hover:bg-white hover:text-black hover:border-black focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition-colors'
              >
                {{ 'templates.contact.form.send' | t }}
              </button>
            </div>
          {%- endform -%}
        </div>
      </div>
    </div>
  </div>
</div>
